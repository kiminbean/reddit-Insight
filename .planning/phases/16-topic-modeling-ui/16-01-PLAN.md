# Plan 16-01: Topic Modeling UI

## Objective

TopicModeler ML 모듈의 토픽 분석 결과를 대시보드에 시각화한다. 토픽별 키워드, 문서 분포, coherence score를 표시한다.

## Execution Context

```
src/reddit_insight/analysis/ml/
├── topic_modeler.py        # TopicModeler (LDA/NMF)
└── models.py               # TopicResult, Topic

src/reddit_insight/dashboard/
├── routers/
├── templates/
```

## Context

### TopicModeler API

```python
from reddit_insight.analysis.ml import TopicModeler, TopicModelerConfig

modeler = TopicModeler(TopicModelerConfig(
    n_topics=5,
    method="auto",  # lda 또는 nmf 자동 선택
    max_features=1000
))

result = modeler.fit_transform(documents)
# result.topics: list[Topic]
#   - topic_id: int
#   - keywords: list[tuple[str, float]]  # (키워드, 가중치)
#   - coherence_score: float
# result.document_topics: list[list[float]]  # 문서별 토픽 분포
# result.method_used: str
# result.coherence_score: float  # 전체 coherence
```

### 구현 목표

1. 수집된 게시물/댓글에서 토픽 추출
2. 토픽별 키워드 클라우드 표시
3. 토픽 분포 파이 차트 표시

## Tasks

### Task 1: TopicService 생성

**목표**: TopicModeler를 래핑하여 대시보드용 데이터 제공

**파일**: `src/reddit_insight/dashboard/services/topic_service.py`

**구현**:
```python
class TopicService:
    def __init__(self):
        self._modeler = TopicModeler(TopicModelerConfig())
        self._cached_result: TopicResult | None = None

    def analyze_topics(self, documents: list[str], n_topics: int = 5) -> dict:
        """문서에서 토픽을 추출한다."""
        result = self._modeler.fit_transform(documents)
        self._cached_result = result
        return {
            "topics": [
                {
                    "id": t.topic_id,
                    "keywords": t.keywords[:10],
                    "coherence": t.coherence_score,
                }
                for t in result.topics
            ],
            "method": result.method_used,
            "overall_coherence": result.coherence_score,
        }

    def get_topic_distribution(self) -> dict:
        """토픽별 문서 분포를 반환한다."""
```

### Task 2: Topics 라우터 생성

**목표**: 토픽 분석 페이지 및 API

**파일**: `src/reddit_insight/dashboard/routers/topics.py`

**구현**:
```python
router = APIRouter(prefix="/dashboard/topics", tags=["topics"])

@router.get("/", response_class=HTMLResponse)
async def topics_home(request: Request) -> HTMLResponse:
    """토픽 분석 메인 페이지."""

@router.get("/analyze", response_class=JSONResponse)
async def analyze_topics(
    n_topics: int = Query(default=5, ge=2, le=10)
) -> JSONResponse:
    """토픽 분석을 실행하고 결과를 반환한다."""

@router.get("/distribution", response_class=JSONResponse)
async def topic_distribution() -> JSONResponse:
    """토픽별 문서 분포 데이터를 반환한다."""
```

### Task 3: Topics 페이지 템플릿 생성

**목표**: 토픽 분석 결과를 시각화하는 페이지

**파일**: `src/reddit_insight/dashboard/templates/topics/index.html`

**구현**:
- 토픽 수 선택 슬라이더 (2-10)
- "분석 실행" 버튼
- 토픽별 키워드 카드 (상위 10개 키워드 + 가중치)
- 토픽 분포 파이 차트 (Chart.js)
- Coherence Score 표시

### Task 4: 내비게이션에 Topics 메뉴 추가

**목표**: 대시보드 네비게이션에 Topics 링크 추가

**파일**: `src/reddit_insight/dashboard/templates/base.html`

**구현**:
- 사이드바에 "Topics" 메뉴 항목 추가
- 아이콘 및 활성 상태 스타일

## Verification

```bash
# 1. 서비스 테스트
pytest tests/dashboard/test_topic_service.py -v

# 2. API 테스트
curl http://localhost:8888/dashboard/topics/analyze?n_topics=5

# 3. UI 확인
# 브라우저에서 /dashboard/topics 접속
# "분석 실행" 클릭 후 토픽 카드 및 차트 확인
```

## Success Criteria

- [ ] TopicService가 TopicModeler 호출 성공
- [ ] `/dashboard/topics` 페이지 렌더링
- [ ] 토픽별 키워드 카드 표시
- [ ] 토픽 분포 파이 차트 표시
- [ ] Coherence Score 표시

## Output

- `src/reddit_insight/dashboard/services/topic_service.py` 생성
- `src/reddit_insight/dashboard/routers/topics.py` 생성
- `src/reddit_insight/dashboard/templates/topics/index.html` 생성
- `src/reddit_insight/dashboard/templates/base.html` 수정
- `src/reddit_insight/dashboard/app.py` 수정 (라우터 등록)
- `tests/dashboard/test_topic_service.py` 생성
- 16-01-SUMMARY.md 작성
