# Plan 14-01: Trend Prediction UI

## Objective

TrendPredictor ML 모듈의 시계열 예측 결과를 대시보드에 시각화한다. 예측값, 신뢰구간, 예측 정확도를 차트로 표시한다.

## Execution Context

```
src/reddit_insight/analysis/ml/
├── trend_predictor.py      # TrendPredictor (ETS/ARIMA)
└── models.py               # PredictionResult

src/reddit_insight/dashboard/
├── routers/trends.py       # 기존 트렌드 라우터
├── templates/trends/
│   ├── index.html
│   └── partials/
```

## Context

### TrendPredictor API

```python
from reddit_insight.analysis.ml import TrendPredictor, TrendPredictorConfig

predictor = TrendPredictor(TrendPredictorConfig(
    method="auto",  # ETS 또는 ARIMA 자동 선택
    forecast_periods=7,
    confidence_level=0.95
))

result = predictor.predict(time_series_data)
# result.predictions: list[float]  # 예측값
# result.confidence_lower: list[float]  # 하한
# result.confidence_upper: list[float]  # 상한
# result.method_used: str  # 사용된 메서드
# result.metrics: dict  # MAE, RMSE 등
```

### 구현 목표

1. 키워드 선택 시 해당 키워드의 시계열 예측 표시
2. 실제값 + 예측값 + 신뢰구간을 하나의 차트에 표시
3. 예측 정확도 메트릭 표시

## Tasks

### Task 1: PredictionService 생성

**목표**: TrendPredictor를 래핑하여 대시보드용 데이터 제공

**파일**: `src/reddit_insight/dashboard/services/prediction_service.py`

**구현**:
```python
class PredictionService:
    def __init__(self):
        self._predictor = TrendPredictor(TrendPredictorConfig())

    def predict_keyword_trend(
        self, keyword: str, historical_data: list[float], forecast_days: int = 7
    ) -> dict:
        """키워드의 트렌드 예측을 수행한다."""
        result = self._predictor.predict(historical_data)
        return {
            "keyword": keyword,
            "predictions": result.predictions,
            "confidence_lower": result.confidence_lower,
            "confidence_upper": result.confidence_upper,
            "method": result.method_used,
            "metrics": result.metrics,
        }
```

### Task 2: 예측 API 엔드포인트 추가

**목표**: 키워드 예측 데이터를 JSON으로 반환하는 API

**파일**: `src/reddit_insight/dashboard/routers/trends.py`

**구현**:
```python
@router.get("/predict/{keyword}", response_class=JSONResponse)
async def predict_keyword(
    keyword: str,
    days: int = Query(default=7, ge=1, le=14),
    service: TrendService = Depends(get_trend_service),
) -> JSONResponse:
    """키워드의 트렌드 예측 데이터를 반환한다."""
```

### Task 3: 예측 차트 컴포넌트 생성

**목표**: Chart.js를 사용한 예측 시각화

**파일**: `src/reddit_insight/dashboard/templates/trends/partials/prediction_chart.html`

**구현**:
- 실제 데이터: 실선 (파란색)
- 예측 데이터: 점선 (파란색)
- 신뢰구간: 반투명 영역 (연한 파란색)
- 메트릭 표시: MAE, Method Used

### Task 4: Trends 페이지에 예측 섹션 추가

**목표**: 키워드 클릭 시 예측 차트 표시

**파일**: `src/reddit_insight/dashboard/templates/trends/index.html`

**구현**:
- 키워드 클릭 이벤트 → HTMX로 예측 차트 로드
- 예측 기간 선택 드롭다운 (3일, 7일, 14일)

## Verification

```bash
# 1. 서비스 테스트
pytest tests/dashboard/test_prediction_service.py -v

# 2. API 테스트
curl http://localhost:8888/dashboard/trends/predict/claude?days=7

# 3. UI 확인
# 브라우저에서 트렌드 페이지 → 키워드 클릭 → 예측 차트 확인
```

## Success Criteria

- [ ] PredictionService가 TrendPredictor 호출 성공
- [ ] `/dashboard/trends/predict/{keyword}` API 동작
- [ ] 예측 차트가 실제값, 예측값, 신뢰구간 표시
- [ ] 예측 메트릭 (MAE, 방법) 표시

## Output

- `src/reddit_insight/dashboard/services/prediction_service.py` 생성
- `src/reddit_insight/dashboard/routers/trends.py` 수정
- `src/reddit_insight/dashboard/templates/trends/partials/prediction_chart.html` 생성
- `src/reddit_insight/dashboard/templates/trends/index.html` 수정
- `tests/dashboard/test_prediction_service.py` 생성
- 14-01-SUMMARY.md 작성
