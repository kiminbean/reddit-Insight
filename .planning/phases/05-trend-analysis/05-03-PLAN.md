---
phase: 05-trend-analysis
plan: 03
type: execute
depends_on: ["05-02", "04-01"]
files_modified: [src/reddit_insight/analysis/trends.py, src/reddit_insight/analysis/time_series.py]
---

<objective>
시계열 트렌드 분석 기능을 구현한다.

Purpose: 키워드 빈도의 시간별 변화를 추적하고 트렌드 파악
Output: 시계열 데이터 구조, 트렌드 계산, 변화율 분석
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-trend-analysis/05-02-PLAN.md

**Prior plan context:**
- Keyword, UnifiedKeywordExtractor 구현됨
- PostModel에 reddit_created_utc, fetched_at 타임스탬프 있음
- 데이터베이스에서 시간별 데이터 조회 가능

**Analysis goals:**
- 키워드별 시간대별 빈도 추적
- 상승/하락 트렌드 식별
- 이동 평균으로 노이즈 제거
</context>

<tasks>

<task type="auto">
  <name>Task 1: 시계열 데이터 구조</name>
  <files>src/reddit_insight/analysis/time_series.py</files>
  <action>
  src/reddit_insight/analysis/time_series.py 생성:

  1. TimeGranularity 열거형:
     - HOUR: 시간별
     - DAY: 일별
     - WEEK: 주별
     - MONTH: 월별

  2. TimePoint 데이터 클래스:
     - timestamp: datetime
     - value: float
     - count: int | None = None

  3. TimeSeries 데이터 클래스:
     - keyword: str
     - granularity: TimeGranularity
     - points: list[TimePoint]
     - start_time: datetime
     - end_time: datetime

  4. 유틸리티 메서드:
     - to_dict() -> dict
     - to_dataframe() -> 선택적 (pandas 있으면)
     - get_values() -> list[float]
     - get_timestamps() -> list[datetime]

  5. 시간 버킷팅:
     - bucket_timestamp(dt: datetime, granularity: TimeGranularity) -> datetime
       - 시간을 해당 단위로 반올림/내림
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.time_series import TimeSeries, TimeGranularity, TimePoint; print('TimeSeries OK')"
  </verify>
  <done>
  - 시계열 데이터 구조 정의됨
  - 시간 단위별 버킷팅 지원
  </done>
</task>

<task type="auto">
  <name>Task 2: 트렌드 계산기</name>
  <files>src/reddit_insight/analysis/trends.py</files>
  <action>
  src/reddit_insight/analysis/trends.py 생성:

  1. TrendDirection 열거형:
     - RISING: 상승 트렌드
     - FALLING: 하락 트렌드
     - STABLE: 안정적
     - VOLATILE: 변동성 높음

  2. TrendMetrics 데이터 클래스:
     - direction: TrendDirection
     - change_rate: float (% 변화)
     - slope: float (기울기)
     - volatility: float (표준편차)
     - momentum: float (최근 변화 강도)

  3. TrendCalculator 클래스:
     - __init__(smoothing_window: int = 3)
     - _window: int

  4. 메서드:
     - calculate_trend(series: TimeSeries) -> TrendMetrics:
       - 전체 트렌드 계산
     - get_moving_average(series: TimeSeries, window: int) -> list[float]:
       - 이동 평균 계산
     - get_change_rate(series: TimeSeries, periods: int = 1) -> float:
       - 기간별 변화율 (%)
     - get_slope(series: TimeSeries) -> float:
       - 선형 회귀 기울기
     - classify_direction(metrics: TrendMetrics) -> TrendDirection:
       - 방향 분류

  5. 임계값 설정:
     - RISING_THRESHOLD = 0.1 (10% 이상 상승)
     - FALLING_THRESHOLD = -0.1
     - VOLATILITY_THRESHOLD = 0.3
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.trends import TrendCalculator, TrendDirection; print('TrendCalculator OK')"
  </verify>
  <done>
  - TrendCalculator가 트렌드 지표 계산
  - 방향 분류 및 변화율 분석
  </done>
</task>

<task type="auto">
  <name>Task 3: 키워드 트렌드 분석기</name>
  <files>src/reddit_insight/analysis/trends.py</files>
  <action>
  trends.py에 KeywordTrendAnalyzer 클래스 추가:

  1. KeywordTrendAnalyzer 클래스:
     - __init__(
         keyword_extractor: UnifiedKeywordExtractor | None = None,
         trend_calculator: TrendCalculator | None = None
       )
     - _extractor: UnifiedKeywordExtractor
     - _calculator: TrendCalculator

  2. 시계열 생성:
     - build_keyword_timeseries(
         posts: list[Post],
         keyword: str,
         granularity: TimeGranularity = TimeGranularity.DAY
       ) -> TimeSeries:
       - 게시물에서 키워드 빈도 시계열 생성

     - build_multiple_timeseries(
         posts: list[Post],
         keywords: list[str],
         granularity: TimeGranularity = TimeGranularity.DAY
       ) -> dict[str, TimeSeries]:
       - 여러 키워드 동시 추적

  3. 트렌드 분석:
     - analyze_keyword_trend(
         posts: list[Post],
         keyword: str,
         granularity: TimeGranularity = TimeGranularity.DAY
       ) -> KeywordTrendResult:
       - 키워드의 트렌드 분석

  4. KeywordTrendResult 데이터 클래스:
     - keyword: str
     - series: TimeSeries
     - metrics: TrendMetrics
     - analyzed_at: datetime
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.trends import KeywordTrendAnalyzer; print('KeywordTrendAnalyzer OK')"
  </verify>
  <done>
  - 키워드별 시계열 트렌드 분석 가능
  - 여러 키워드 동시 추적 지원
  </done>
</task>

<task type="auto">
  <name>Task 4: export 및 통합</name>
  <files>src/reddit_insight/analysis/__init__.py</files>
  <action>
  __init__.py 업데이트:
  - TimeSeries, TimeGranularity, TimePoint export
  - TrendCalculator, TrendDirection, TrendMetrics export
  - KeywordTrendAnalyzer, KeywordTrendResult export
  - __all__ 업데이트
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis import KeywordTrendAnalyzer, TimeSeries, TrendDirection; print('All trend exports OK')"
  </verify>
  <done>
  - 트렌드 분석 모듈 export 완료
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TimeSeries 데이터 구조 정의됨
- [ ] TrendCalculator가 트렌드 지표 계산
- [ ] KeywordTrendAnalyzer가 키워드 트렌드 분석
- [ ] 모듈 export 정상
</verification>

<success_criteria>

- 모든 태스크 완료
- 시계열 트렌드 분석 동작
- 키워드 빈도 변화 추적 가능

</success_criteria>

<output>
After completion, create `.planning/phases/05-trend-analysis/05-03-SUMMARY.md`
</output>
