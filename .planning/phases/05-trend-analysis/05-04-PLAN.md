---
phase: 05-trend-analysis
plan: 04
type: execute
depends_on: ["05-03"]
files_modified: [src/reddit_insight/analysis/rising.py, src/reddit_insight/analysis/__init__.py, tests/test_analysis.py]
---

<objective>
급상승 키워드 탐지 시스템을 구현한다.

Purpose: 빠르게 상승하는 키워드를 자동으로 탐지하여 새로운 트렌드 발견
Output: RisingKeywordDetector, 급상승 점수, 알림 기준
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-trend-analysis/05-03-PLAN.md

**Prior plan context:**
- KeywordTrendAnalyzer, TrendCalculator 구현됨
- TimeSeries, TrendMetrics 데이터 구조 있음
- UnifiedKeywordExtractor로 키워드 추출 가능

**Rising detection strategy:**
- 최근 기간 vs 이전 기간 비교
- 빈도 증가율 + 절대 빈도 고려
- 이상치 탐지 (평균 + N*표준편차)
</context>

<tasks>

<task type="auto">
  <name>Task 1: 급상승 점수 계산</name>
  <files>src/reddit_insight/analysis/rising.py</files>
  <action>
  src/reddit_insight/analysis/rising.py 생성:

  1. RisingScore 데이터 클래스:
     - keyword: str
     - score: float (0-100, 높을수록 급상승)
     - growth_rate: float (% 증가율)
     - recent_frequency: int
     - previous_frequency: int
     - is_new: bool (이전 기간에 없었던 키워드)

  2. RisingConfig 데이터 클래스:
     - recent_period_hours: int = 24 (최근 기간)
     - comparison_period_hours: int = 168 (비교 기간, 1주)
     - min_recent_frequency: int = 3 (최소 최근 빈도)
     - min_growth_rate: float = 0.5 (50% 이상 증가)
     - new_keyword_bonus: float = 20.0 (새 키워드 보너스)

  3. RisingScoreCalculator 클래스:
     - __init__(config: RisingConfig | None = None)
     - _config: RisingConfig

  4. 점수 계산 메서드:
     - calculate_score(
         recent_freq: int,
         previous_freq: int,
         is_new: bool = False
       ) -> RisingScore:
       - 급상승 점수 계산

     - _growth_rate(recent: int, previous: int) -> float:
       - 증가율 계산 (0으로 나누기 처리)

     - _normalize_score(growth_rate: float, frequency: int) -> float:
       - 0-100 범위로 정규화

  주의:
  - 새 키워드 (이전=0)는 높은 보너스
  - 절대 빈도가 낮으면 점수 조정
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.rising import RisingScoreCalculator, RisingScore; calc = RisingScoreCalculator(); score = calc.calculate_score(10, 2); print(f'Score: {score.score:.1f}, Growth: {score.growth_rate:.0%}')"
  </verify>
  <done>
  - 급상승 점수 계산 로직 구현
  - 새 키워드 보너스 처리
  </done>
</task>

<task type="auto">
  <name>Task 2: 급상승 키워드 탐지기</name>
  <files>src/reddit_insight/analysis/rising.py</files>
  <action>
  rising.py에 RisingKeywordDetector 클래스 추가:

  1. RisingKeywordDetector 클래스:
     - __init__(
         keyword_extractor: UnifiedKeywordExtractor | None = None,
         config: RisingConfig | None = None
       )
     - _extractor: UnifiedKeywordExtractor
     - _calculator: RisingScoreCalculator
     - _config: RisingConfig

  2. 탐지 메서드:
     - detect_rising(
         posts: list[Post],
         top_n: int = 20
       ) -> list[RisingScore]:
       - 게시물에서 급상승 키워드 탐지
       - 상위 N개 반환 (점수 순)

     - detect_from_database(
         database: Database,
         subreddit: str | None = None,
         top_n: int = 20
       ) -> list[RisingScore]:
       - 데이터베이스에서 직접 분석

  3. 기간별 빈도 계산:
     - _count_keywords_in_period(
         posts: list[Post],
         start: datetime,
         end: datetime
       ) -> dict[str, int]:
       - 기간 내 키워드별 빈도 집계

     - _filter_by_time(
         posts: list[Post],
         start: datetime,
         end: datetime
       ) -> list[Post]:
       - 시간 범위로 게시물 필터링

  4. 임계값 필터링:
     - _filter_rising(scores: list[RisingScore]) -> list[RisingScore]:
       - config 기준 미달 제외
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.rising import RisingKeywordDetector; d = RisingKeywordDetector(); print('RisingKeywordDetector OK')"
  </verify>
  <done>
  - 급상승 키워드 자동 탐지
  - 데이터베이스 직접 분석 지원
  </done>
</task>

<task type="auto">
  <name>Task 3: 트렌드 리포트 생성</name>
  <files>src/reddit_insight/analysis/rising.py</files>
  <action>
  rising.py에 리포트 기능 추가:

  1. TrendReport 데이터 클래스:
     - generated_at: datetime
     - period_start: datetime
     - period_end: datetime
     - subreddit: str | None
     - rising_keywords: list[RisingScore]
     - top_keywords: list[Keyword]
     - total_posts_analyzed: int

  2. TrendReporter 클래스:
     - __init__(
         rising_detector: RisingKeywordDetector | None = None,
         keyword_extractor: UnifiedKeywordExtractor | None = None
       )

  3. 리포트 생성:
     - generate_report(
         posts: list[Post],
         subreddit: str | None = None
       ) -> TrendReport:
       - 급상승 + 상위 키워드 종합 리포트

     - to_dict(report: TrendReport) -> dict:
       - JSON 직렬화 가능 형태

     - to_markdown(report: TrendReport) -> str:
       - 마크다운 형식 출력

  4. 요약 통계:
     - _summarize_trends(report: TrendReport) -> str:
       - 간단한 텍스트 요약
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.rising import TrendReporter, TrendReport; print('TrendReporter OK')"
  </verify>
  <done>
  - 트렌드 리포트 자동 생성
  - 마크다운 출력 지원
  </done>
</task>

<task type="auto">
  <name>Task 4: export 및 테스트</name>
  <files>src/reddit_insight/analysis/__init__.py, tests/test_analysis.py</files>
  <action>
  1. __init__.py 업데이트:
     - RisingScore, RisingConfig export
     - RisingKeywordDetector, RisingScoreCalculator export
     - TrendReport, TrendReporter export
     - __all__ 최종 업데이트

  2. tests/test_analysis.py 생성:
     - TestRedditTokenizer: 토큰화 테스트
     - TestYAKEExtractor: 키워드 추출 테스트
     - TestTrendCalculator: 트렌드 계산 테스트
     - TestRisingDetector: 급상승 탐지 테스트

  3. 통합 확인:
     - 전체 분석 파이프라인 import 테스트
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis import RisingKeywordDetector, TrendReporter, UnifiedKeywordExtractor, KeywordTrendAnalyzer; print('All Phase 5 exports OK')"
  - python -m pytest tests/test_analysis.py -v --collect-only 2>/dev/null || echo "Tests defined"
  </verify>
  <done>
  - Phase 5 모든 기능 export됨
  - 기본 테스트 작성됨
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] RisingScoreCalculator가 급상승 점수 계산
- [ ] RisingKeywordDetector가 급상승 키워드 탐지
- [ ] TrendReporter가 종합 리포트 생성
- [ ] 테스트 파일 존재
</verification>

<success_criteria>

- 모든 태스크 완료
- 급상승 키워드 자동 탐지 동작
- 트렌드 리포트 생성 가능
- Phase 5 완료

</success_criteria>

<output>
After completion, create `.planning/phases/05-trend-analysis/05-04-SUMMARY.md`
</output>
