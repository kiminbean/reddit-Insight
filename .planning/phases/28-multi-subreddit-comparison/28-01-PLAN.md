---
phase: 28-multi-subreddit-comparison
plan: 01
type: execute
depends_on: ["27-01"]
files_modified: [src/reddit_insight/analysis/comparison.py, src/reddit_insight/dashboard/services/comparison_service.py, src/reddit_insight/dashboard/routers/comparison.py]
---

<objective>
멀티 서브레딧 비교 분석 기능을 구현한다: 크로스 서브레딧 트렌드 비교, 벤치마킹.

Purpose: 여러 서브레딧 간의 비교 분석으로 시장 트렌드 파악
Output: ComparisonAnalyzer, ComparisonService, 비교 UI
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/reddit_insight/analysis/trend.py
@src/reddit_insight/dashboard/data_store.py

**비교 분석 요구사항:**
- 동시에 2-5개 서브레딧 분석
- 공통/고유 키워드 식별
- 감성 비교
- 활동량 비교
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Comparison Analyzer</name>
  <files>src/reddit_insight/analysis/comparison.py</files>
  <action>서브레딧 비교 분석기를 구현한다:

  ```python
  @dataclass
  class SubredditMetrics:
      subreddit: str
      post_count: int
      avg_score: float
      avg_comments: float
      top_keywords: list[str]
      sentiment_distribution: dict[str, float]  # positive, negative, neutral %

  @dataclass
  class ComparisonResult:
      subreddits: list[str]
      metrics: list[SubredditMetrics]
      common_keywords: list[str]  # 모든 서브레딧에 공통
      unique_keywords: dict[str, list[str]]  # 서브레딧별 고유 키워드
      keyword_overlap_matrix: list[list[float]]  # Jaccard similarity
      sentiment_comparison: dict[str, dict]

  class ComparisonAnalyzer:
      def __init__(self, data_sources: list[AnalysisData]):
          self.data_sources = data_sources

      def compare(self) -> ComparisonResult:
          """여러 서브레딧 비교 분석 실행"""

      def calculate_keyword_overlap(self) -> list[list[float]]:
          """키워드 Jaccard 유사도 행렬 계산"""

      def find_common_keywords(self, min_overlap: int = 2) -> list[str]:
          """N개 이상 서브레딧에서 공통으로 나타나는 키워드"""

      def find_unique_keywords(self) -> dict[str, list[str]]:
          """각 서브레딧의 고유 키워드 (다른 곳에 없는)"""
  ```</action>
  <verify>pytest tests/analysis/test_comparison.py -v</verify>
  <done>ComparisonAnalyzer 구현 완료</done>
</task>

<task type="auto">
  <name>Task 2: Create Comparison Dashboard Service</name>
  <files>src/reddit_insight/dashboard/services/comparison_service.py, src/reddit_insight/dashboard/services/__init__.py</files>
  <action>비교 분석 대시보드 서비스를 구현한다:

  ```python
  class ComparisonService:
      def __init__(self, cache: CacheService):
          self.cache = cache

      async def compare_subreddits(self, subreddits: list[str]) -> ComparisonResult | None:
          """여러 서브레딧 비교 분석
          1. 각 서브레딧의 분석 데이터 로드
          2. ComparisonAnalyzer로 비교
          3. 결과 캐싱 및 반환
          """

      def get_comparison_chart_data(self, result: ComparisonResult) -> dict:
          """Chart.js 형식의 비교 차트 데이터
          - 활동량 비교 바 차트
          - 감성 분포 스택 바 차트
          - 키워드 오버랩 히트맵
          """

      async def load_subreddit_data(self, subreddit: str) -> AnalysisData | None:
          """서브레딧 분석 데이터 로드 (파일 또는 DB에서)"""
  ```</action>
  <verify>pytest tests/dashboard/test_comparison_service.py -v</verify>
  <done>ComparisonService 구현 완료</done>
</task>

<task type="auto">
  <name>Task 3: Add Comparison UI</name>
  <files>src/reddit_insight/dashboard/routers/comparison.py, src/reddit_insight/dashboard/templates/comparison/index.html, src/reddit_insight/dashboard/templates/comparison/partials/results.html</files>
  <action>비교 분석 UI를 구현한다:

  1. 라우터 (comparison.py):
     - GET /dashboard/comparison - 비교 페이지
     - POST /dashboard/comparison/analyze - 비교 분석 실행
     - GET /dashboard/comparison/chart-data - 차트 데이터

  2. UI 컴포넌트:
     - 서브레딧 선택기 (멀티 셀렉트, 최대 5개)
     - 분석 버튼
     - 결과 대시보드:
       - 메트릭 비교 테이블
       - 활동량 비교 바 차트
       - 감성 분포 비교 차트
       - 공통/고유 키워드 벤 다이어그램 (또는 리스트)
       - 키워드 유사도 히트맵

  3. HTMX 인터랙션:
     - 서브레딧 선택 시 유효성 검사
     - 분석 진행 중 로딩 표시
     - 결과 동적 업데이트</action>
  <verify>브라우저에서 /dashboard/comparison 작동 확인</verify>
  <done>비교 분석 UI 구현 완료</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] ComparisonAnalyzer 단위 테스트 통과
- [ ] ComparisonService 단위 테스트 통과
- [ ] /dashboard/comparison 페이지 렌더링
- [ ] 2-5개 서브레딧 비교 작동
</verification>

<success_criteria>

- ComparisonAnalyzer: metrics, overlap, common/unique keywords
- ComparisonService: 데이터 로딩, 차트 데이터 생성
- 비교 UI: 서브레딧 선택, 결과 시각화
</success_criteria>

<output>
After completion, create `.planning/phases/28-multi-subreddit-comparison/28-01-SUMMARY.md`
</output>
