---
phase: 22-dashboard-performance
plan: 01
type: execute
depends_on: ["21-01"]
files_modified: [src/reddit_insight/dashboard/services/cache_service.py, src/reddit_insight/dashboard/routers/*.py, src/reddit_insight/dashboard/templates/*.html]
---

<objective>
대시보드 성능을 최적화한다: 캐싱, 페이지네이션, 지연 로딩 구현.

Purpose: 대규모 데이터에서도 빠른 응답 시간과 원활한 사용자 경험 제공
Output: CacheService, 페이지네이션 컴포넌트, 지연 로딩 구현
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/reddit_insight/dashboard/services/__init__.py
@src/reddit_insight/dashboard/routers/__init__.py

**현재 성능 이슈:**
- 대량 키워드/인사이트 로딩 시 응답 지연
- ML 분석 결과 매번 재계산
- 페이지네이션 없는 전체 데이터 로딩
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Cache Service</name>
  <files>src/reddit_insight/dashboard/services/cache_service.py, src/reddit_insight/dashboard/services/__init__.py</files>
  <action>메모리 기반 캐시 서비스를 구현한다:

  ```python
  class CacheService:
      def __init__(self, default_ttl: int = 300):
          self._cache: dict[str, tuple[Any, float]] = {}
          self._default_ttl = default_ttl

      def get(self, key: str) -> Any | None
      def set(self, key: str, value: Any, ttl: int | None = None) -> None
      def delete(self, key: str) -> None
      def clear(self) -> None
      def get_or_set(self, key: str, factory: Callable, ttl: int | None = None) -> Any
  ```

  - TTL 기반 만료
  - 분석 결과, ML 예측 결과 캐싱
  - 키 패턴: "analysis:{subreddit}", "prediction:{keyword}", "topics:{hash}"</action>
  <verify>pytest tests/dashboard/test_cache_service.py -v (테스트 작성 포함)</verify>
  <done>CacheService 구현 완료, 단위 테스트 통과</done>
</task>

<task type="auto">
  <name>Task 2: Add Pagination to Data Endpoints</name>
  <files>src/reddit_insight/dashboard/routers/trends.py, src/reddit_insight/dashboard/routers/demands.py, src/reddit_insight/dashboard/routers/insights.py</files>
  <action>데이터 엔드포인트에 페이지네이션을 추가한다:

  - 공통 페이지네이션 파라미터: page (default=1), per_page (default=20, max=100)
  - 응답에 메타데이터 포함: total, page, per_page, pages
  - 키워드 목록, 인사이트 목록, 수요 목록에 적용

  예시 응답:
  ```json
  {
    "items": [...],
    "meta": {
      "total": 150,
      "page": 1,
      "per_page": 20,
      "pages": 8
    }
  }
  ```</action>
  <verify>curl "http://localhost:8888/dashboard/trends/keywords?page=1&per_page=10" 응답 확인</verify>
  <done>3개 라우터에 페이지네이션 적용 완료</done>
</task>

<task type="auto">
  <name>Task 3: Implement Lazy Loading for Charts</name>
  <files>src/reddit_insight/dashboard/templates/trends/index.html, src/reddit_insight/dashboard/templates/base.html</files>
  <action>차트 데이터의 지연 로딩을 구현한다:

  - HTMX hx-trigger="revealed" 사용하여 뷰포트 진입 시 로딩
  - 로딩 스켈레톤 표시
  - 차트별 개별 API 호출로 초기 페이지 로딩 시간 단축

  ```html
  <div hx-get="/dashboard/trends/chart/{keyword}"
       hx-trigger="revealed"
       hx-swap="innerHTML">
    <div class="skeleton-chart">Loading...</div>
  </div>
  ```</action>
  <verify>브라우저 개발자 도구 Network 탭에서 스크롤 시 차트 로딩 확인</verify>
  <done>지연 로딩 구현 완료, 초기 로딩 시간 개선</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] CacheService 단위 테스트 통과
- [ ] 페이지네이션 API 응답 형식 검증
- [ ] 지연 로딩 동작 확인
- [ ] 기존 테스트 회귀 없음
</verification>

<success_criteria>

- CacheService 구현 및 ML 분석 결과 캐싱
- 3개 이상의 데이터 엔드포인트에 페이지네이션 적용
- 차트 지연 로딩으로 초기 페이지 로딩 시간 50% 개선
</success_criteria>

<output>
After completion, create `.planning/phases/22-dashboard-performance/22-01-SUMMARY.md`
</output>
