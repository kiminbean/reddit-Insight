---
phase: 20-tech-debt-cleanup
plan: 01
type: execute
depends_on: []
files_modified: [tests/e2e/test_api_integration.py, tests/e2e/test_dashboard_flow.py, tests/e2e/test_error_handling.py]
---

<objective>
v1.1에서 발생한 12개의 실패한 E2E 테스트를 수정하고 코드 품질을 개선한다.

Purpose: 기술 부채를 해결하여 v2.0 개발의 안정적인 기반 마련
Output: 모든 테스트 통과 (537/537), 코드 리팩토링 완료
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**실패한 테스트 목록 (12개):**
1. test_api_integration.py::TestPredictionEndpoints::test_get_prediction_partial
2. test_api_integration.py::TestDemandsEndpoints::test_get_demand_detail
3. test_api_integration.py::TestInsightsEndpoints::test_get_insight_detail_with_valid_id
4. test_api_integration.py::TestInsightsEndpoints::test_get_score_breakdown_chart
5. test_api_integration.py::TestReportEndpoints::test_download_report_no_data
6. test_dashboard_flow.py::TestFullAnalysisFlow::test_analysis_detail_page_with_valid_id
7. test_dashboard_flow.py::TestTopicAnalysisFlow::test_topic_analysis_endpoint_returns_data
8. test_dashboard_flow.py::TestClusterAnalysisFlow::test_cluster_analysis_endpoint_returns_data
9. test_dashboard_flow.py::TestInsightsFlow::test_insight_detail_page_with_valid_id
10. test_dashboard_flow.py::TestDemandsFlow::test_demand_detail_page_with_valid_id
11. test_dashboard_flow.py::TestReportGenerationFlow::test_report_download_without_data_returns_404
12. test_error_handling.py::TestGracefulDegradation::test_database_connection_error_simulation

**관련 소스 파일:**
@tests/e2e/test_api_integration.py
@tests/e2e/test_dashboard_flow.py
@tests/e2e/test_error_handling.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix API Integration Tests</name>
  <files>tests/e2e/test_api_integration.py</files>
  <action>5개의 실패한 API 통합 테스트를 수정한다:
  - test_get_prediction_partial: mock 데이터 설정 확인, 예측 서비스 응답 형식 수정
  - test_get_demand_detail: 유효한 demand ID로 테스트하도록 fixture 수정
  - test_get_insight_detail_with_valid_id: insight detail 라우트 응답 형식 맞춤
  - test_get_score_breakdown_chart: 차트 데이터 응답 형식 검증
  - test_download_report_no_data: 데이터 없을 때 404 반환 확인

  각 테스트에서 실제 응답 형식과 기대 형식의 불일치를 수정한다.</action>
  <verify>PYTHONPATH=src pytest tests/e2e/test_api_integration.py -v --tb=short</verify>
  <done>5개 API 통합 테스트 모두 통과</done>
</task>

<task type="auto">
  <name>Task 2: Fix Dashboard Flow Tests</name>
  <files>tests/e2e/test_dashboard_flow.py</files>
  <action>6개의 실패한 대시보드 플로우 테스트를 수정한다:
  - test_analysis_detail_page_with_valid_id: 분석 상세 페이지 fixture 및 mock 수정
  - test_topic_analysis_endpoint_returns_data: TopicService mock 설정
  - test_cluster_analysis_endpoint_returns_data: ClusterService mock 설정
  - test_insight_detail_page_with_valid_id: 인사이트 상세 라우트 검증
  - test_demand_detail_page_with_valid_id: 수요 상세 라우트 검증
  - test_report_download_without_data_returns_404: 빈 데이터 시 404 응답 검증

  각 테스트의 mock 설정과 기대 응답 형식을 실제 구현과 일치시킨다.</action>
  <verify>PYTHONPATH=src pytest tests/e2e/test_dashboard_flow.py -v --tb=short</verify>
  <done>6개 대시보드 플로우 테스트 모두 통과</done>
</task>

<task type="auto">
  <name>Task 3: Fix Error Handling Tests</name>
  <files>tests/e2e/test_error_handling.py</files>
  <action>1개의 실패한 에러 핸들링 테스트를 수정한다:
  - test_database_connection_error_simulation: 데이터베이스 연결 오류 시뮬레이션 mock 수정

  graceful degradation 동작이 올바르게 테스트되도록 mock 설정을 수정한다.</action>
  <verify>PYTHONPATH=src pytest tests/e2e/test_error_handling.py -v --tb=short</verify>
  <done>에러 핸들링 테스트 통과</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `PYTHONPATH=src pytest tests/ -v` - 모든 537개 테스트 통과
- [ ] 새로운 warning 없음
- [ ] 기존 기능에 regression 없음
</verification>

<success_criteria>

- 12개의 실패한 E2E 테스트 모두 수정
- 전체 테스트 스위트 537/537 통과
- 코드 품질 개선 (중복 제거, 명확한 mock 설정)
</success_criteria>

<output>
After completion, create `.planning/phases/20-tech-debt-cleanup/20-01-SUMMARY.md`
</output>
