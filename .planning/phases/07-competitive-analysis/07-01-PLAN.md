---
phase: 07-competitive-analysis
plan: 01
type: execute
depends_on: ["05-02"]
files_modified: [src/reddit_insight/analysis/entity_recognition.py]
---

<objective>
제품/서비스 엔티티 인식 시스템을 구현한다.

Purpose: 텍스트에서 제품명, 서비스명, 브랜드명을 자동으로 추출
Output: EntityRecognizer, ProductEntity, 엔티티 추출 파이프라인
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/reddit_insight/analysis/keywords.py

**Prior phase context:**
- UnifiedKeywordExtractor, YAKEExtractor 구현됨
- RedditTokenizer로 텍스트 전처리 가능
- Post, Comment 모델 정의됨

**Entity recognition approach (lightweight, no heavy ML):**
- 패턴 기반: 대문자로 시작하는 단어, CamelCase
- 컨텍스트 기반: "using X", "switched to X", "X is better"
- 키워드 기반: 알려진 제품/서비스 사전
</context>

<tasks>

<task type="auto">
  <name>Task 1: 엔티티 데이터 구조</name>
  <files>src/reddit_insight/analysis/entity_recognition.py</files>
  <action>
  src/reddit_insight/analysis/entity_recognition.py 생성:

  1. EntityType 열거형:
     - PRODUCT: 제품 (소프트웨어, 하드웨어)
     - SERVICE: 서비스 (SaaS, 웹서비스)
     - BRAND: 브랜드/회사명
     - TECHNOLOGY: 기술/프레임워크
     - UNKNOWN: 미분류

  2. ProductEntity 데이터 클래스:
     - name: str (원본 텍스트)
     - normalized_name: str (정규화된 이름)
     - entity_type: EntityType
     - confidence: float (0-1)
     - context: str (발견된 문맥)
     - mentions: int = 1 (언급 횟수)

  3. EntityMention 데이터 클래스:
     - entity: ProductEntity
     - text: str (원본 텍스트)
     - start: int
     - end: int
     - sentence: str (포함 문장)
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.entity_recognition import EntityType, ProductEntity, EntityMention; print('Entity structures OK')"
  </verify>
  <done>
  - 엔티티 데이터 구조 정의됨
  - 5가지 엔티티 타입 정의
  </done>
</task>

<task type="auto">
  <name>Task 2: 패턴 기반 엔티티 추출</name>
  <files>src/reddit_insight/analysis/entity_recognition.py</files>
  <action>
  entity_recognition.py에 패턴 추출기 추가:

  1. EntityPattern 데이터 클래스:
     - pattern_id: str
     - regex: str
     - entity_type: EntityType
     - weight: float = 1.0

  2. ENTITY_PATTERNS 리스트:
     **제품/서비스 컨텍스트 패턴:**
     - r"(?:using|use|tried|switched to|moved to)\s+([A-Z][a-zA-Z0-9]*(?:\s+[A-Z][a-zA-Z0-9]*)?)"
     - r"([A-Z][a-zA-Z0-9]*(?:\s+[A-Z][a-zA-Z0-9]*)?)\s+(?:is|was|has been)\s+(?:great|good|bad|terrible)"
     - r"(?:recommend|suggesting?)\s+([A-Z][a-zA-Z0-9]*)"

     **브랜드 패턴:**
     - r"(?:by|from|made by)\s+([A-Z][a-zA-Z0-9]+)"

     **기술 패턴:**
     - r"(?:built with|powered by|using)\s+([A-Z][a-zA-Z0-9]+(?:\.[a-zA-Z]+)?)"

  3. PatternEntityExtractor 클래스:
     - __init__(patterns: list[EntityPattern] | None = None)
     - _patterns: list[EntityPattern]
     - _compiled: dict[str, re.Pattern]

  4. 추출 메서드:
     - extract(text: str) -> list[EntityMention]:
       - 패턴 매칭으로 엔티티 추출
     - _normalize_name(name: str) -> str:
       - 이름 정규화 (소문자, 공백 정리)
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.entity_recognition import PatternEntityExtractor; e = PatternEntityExtractor(); mentions = e.extract('I switched to Notion and it is great'); print(f'Found {len(mentions)} entities')"
  </verify>
  <done>
  - 패턴 기반 엔티티 추출 구현
  - 컨텍스트 패턴으로 제품/서비스 인식
  </done>
</task>

<task type="auto">
  <name>Task 3: 통합 엔티티 인식기</name>
  <files>src/reddit_insight/analysis/entity_recognition.py</files>
  <action>
  entity_recognition.py에 통합 클래스 추가:

  1. EntityRecognizerConfig 데이터 클래스:
     - min_confidence: float = 0.3
     - merge_similar: bool = True
     - similarity_threshold: float = 0.8

  2. EntityRecognizer 클래스:
     - __init__(
         config: EntityRecognizerConfig | None = None,
         pattern_extractor: PatternEntityExtractor | None = None
       )
     - _config: EntityRecognizerConfig
     - _pattern_extractor: PatternEntityExtractor

  3. 인식 메서드:
     - recognize(text: str) -> list[ProductEntity]:
       - 텍스트에서 엔티티 인식
       - 중복 병합

     - recognize_in_post(post: Post) -> list[ProductEntity]:
       - Post의 title + selftext 분석

     - recognize_in_posts(posts: list[Post]) -> dict[str, ProductEntity]:
       - 여러 게시물에서 엔티티 집계
       - mentions 카운트 업데이트

  4. 병합 로직:
     - _merge_entities(entities: list[ProductEntity]) -> list[ProductEntity]:
       - 유사 이름 병합
       - mentions 합산
     - _calculate_similarity(name1: str, name2: str) -> float:
       - 이름 유사도 계산
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.entity_recognition import EntityRecognizer; r = EntityRecognizer(); entities = r.recognize('I use Slack for team communication but Notion is better for docs'); print(f'Recognized {len(entities)} entities')"
  </verify>
  <done>
  - 통합 EntityRecognizer 구현
  - 엔티티 병합 및 집계
  </done>
</task>

<task type="auto">
  <name>Task 4: export 및 검증</name>
  <files>src/reddit_insight/analysis/__init__.py</files>
  <action>
  1. __init__.py 업데이트:
     - EntityType, ProductEntity, EntityMention export
     - EntityRecognizer, EntityRecognizerConfig export
     - PatternEntityExtractor export
     - __all__ 업데이트

  2. 통합 검증:
     - 샘플 텍스트로 엔티티 인식 테스트
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis import EntityRecognizer, ProductEntity, EntityType; print('All entity recognition exports OK')"
  </verify>
  <done>
  - 엔티티 인식 모듈 export됨
  - 통합 동작 확인
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] EntityType 5가지 정의됨
- [ ] ProductEntity, EntityMention 데이터 구조 있음
- [ ] PatternEntityExtractor가 패턴 매칭
- [ ] EntityRecognizer가 통합 인식 수행
</verification>

<success_criteria>

- 모든 태스크 완료
- 제품/서비스 엔티티 인식 동작
- 중복 병합 및 집계 가능

</success_criteria>

<output>
After completion, create `.planning/phases/07-competitive-analysis/07-01-SUMMARY.md`
</output>
