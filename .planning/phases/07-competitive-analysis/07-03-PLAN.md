---
phase: 07-competitive-analysis
plan: 03
type: execute
depends_on: ["07-02", "06-01"]
files_modified: [src/reddit_insight/analysis/competitive.py, tests/test_competitive.py]
---

<objective>
불만 및 대안 요구 추출 시스템을 구현한다.

Purpose: 제품/서비스에 대한 불만과 대안 요구를 추출하여 경쟁 분석
Output: CompetitiveAnalyzer, ComplaintExtractor, 경쟁 분석 리포트
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-competitive-analysis/07-01-PLAN.md
@.planning/phases/07-competitive-analysis/07-02-PLAN.md

**Prior plan context:**
- EntityRecognizer로 제품/서비스 인식 가능
- EntitySentimentAnalyzer로 엔티티별 감성 분석 가능
- DemandPatternLibrary의 ALTERNATIVE_SEEKING 패턴 활용 가능

**Complaint patterns:**
- "[Entity] is/was [negative]"
- "problem with [Entity]"
- "issue with [Entity]"
- "[Entity] doesn't/won't [verb]"
- "hate [Entity]"

**Alternative patterns:**
- "switched from [Entity] to [Entity]"
- "alternative to [Entity]"
- "[Entity] vs [Entity]"
- "better than [Entity]"
</context>

<tasks>

<task type="auto">
  <name>Task 1: 불만 추출기</name>
  <files>src/reddit_insight/analysis/competitive.py</files>
  <action>
  src/reddit_insight/analysis/competitive.py 생성:

  1. ComplaintType 열거형:
     - FUNCTIONALITY: 기능 문제
     - PERFORMANCE: 성능 문제
     - USABILITY: 사용성 문제
     - PRICING: 가격 문제
     - SUPPORT: 지원 문제
     - RELIABILITY: 안정성 문제
     - OTHER: 기타

  2. Complaint 데이터 클래스:
     - entity: ProductEntity
     - complaint_type: ComplaintType
     - text: str (원본 텍스트)
     - context: str (문맥)
     - severity: float (0-1, 심각도)
     - keywords: list[str] (불만 키워드)

  3. COMPLAINT_PATTERNS 리스트:
     - r"([A-Z][a-zA-Z0-9]*)\s+(?:is|was|has been)\s+(?:so\s+)?(?:slow|buggy|broken|terrible|awful)"
     - r"(?:problem|issue|trouble)\s+with\s+([A-Z][a-zA-Z0-9]*)"
     - r"([A-Z][a-zA-Z0-9]*)\s+(?:doesn't|won't|can't|couldn't)\s+\w+"
     - r"(?:hate|hated|hating)\s+([A-Z][a-zA-Z0-9]*)"
     - r"([A-Z][a-zA-Z0-9]*)\s+(?:keeps?|kept)\s+(?:crashing|freezing|failing)"

  4. ComplaintExtractor 클래스:
     - __init__(
         entity_recognizer: EntityRecognizer | None = None,
         sentiment_analyzer: RuleBasedSentimentAnalyzer | None = None
       )

  5. 추출 메서드:
     - extract(text: str) -> list[Complaint]:
       - 텍스트에서 불만 추출
     - _classify_complaint_type(text: str) -> ComplaintType:
       - 불만 유형 분류
     - _calculate_severity(sentiment: SentimentScore) -> float:
       - 심각도 계산 (감성 점수 기반)
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.competitive import ComplaintExtractor, Complaint; e = ComplaintExtractor(); complaints = e.extract('Slack is so slow and keeps crashing'); print(f'Found {len(complaints)} complaints')"
  </verify>
  <done>
  - 불만 추출기 구현
  - 불만 유형 분류
  </done>
</task>

<task type="auto">
  <name>Task 2: 대안 비교 추출</name>
  <files>src/reddit_insight/analysis/competitive.py</files>
  <action>
  competitive.py에 대안 추출 추가:

  1. ComparisonType 열거형:
     - SWITCH: 전환 (A에서 B로)
     - ALTERNATIVE: 대안 탐색
     - VERSUS: 비교 (A vs B)
     - BETTER_THAN: 우위 비교
     - RECOMMENDATION: 추천

  2. AlternativeComparison 데이터 클래스:
     - source_entity: ProductEntity (원래 제품)
     - target_entity: ProductEntity | None (대안 제품)
     - comparison_type: ComparisonType
     - text: str
     - context: str
     - sentiment_towards_source: SentimentScore
     - sentiment_towards_target: SentimentScore | None

  3. ALTERNATIVE_PATTERNS 리스트:
     - r"(?:switched|moved|migrated)\s+from\s+([A-Z][a-zA-Z0-9]*)\s+to\s+([A-Z][a-zA-Z0-9]*)"
     - r"([A-Z][a-zA-Z0-9]*)\s+(?:alternative|replacement)"
     - r"alternative\s+to\s+([A-Z][a-zA-Z0-9]*)"
     - r"([A-Z][a-zA-Z0-9]*)\s+vs\.?\s+([A-Z][a-zA-Z0-9]*)"
     - r"([A-Z][a-zA-Z0-9]*)\s+(?:is\s+)?better\s+than\s+([A-Z][a-zA-Z0-9]*)"

  4. AlternativeExtractor 클래스:
     - __init__(
         entity_recognizer: EntityRecognizer | None = None,
         sentiment_analyzer: RuleBasedSentimentAnalyzer | None = None
       )

  5. 추출 메서드:
     - extract(text: str) -> list[AlternativeComparison]:
       - 대안 비교 추출
     - extract_switches(texts: list[str]) -> dict[str, list[str]]:
       - 전환 패턴 집계 (source -> [targets])
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.competitive import AlternativeExtractor; e = AlternativeExtractor(); alts = e.extract('I switched from Evernote to Notion and it is so much better'); print(f'Found {len(alts)} alternatives')"
  </verify>
  <done>
  - 대안 비교 추출 구현
  - 전환 패턴 집계
  </done>
</task>

<task type="auto">
  <name>Task 3: 통합 경쟁 분석기</name>
  <files>src/reddit_insight/analysis/competitive.py</files>
  <action>
  competitive.py에 통합 분석기 추가:

  1. CompetitiveInsight 데이터 클래스:
     - entity: ProductEntity
     - overall_sentiment: SentimentScore
     - complaint_count: int
     - top_complaints: list[Complaint]
     - alternatives_mentioned: list[str]
     - switch_to: list[str] (사람들이 전환하는 대상)
     - switch_from: list[str] (사람들이 떠나오는 대상)

  2. CompetitiveReport 데이터 클래스:
     - generated_at: datetime
     - entities_analyzed: int
     - insights: list[CompetitiveInsight]
     - top_complaints: list[Complaint]
     - popular_switches: list[tuple[str, str, int]] # (from, to, count)
     - recommendations: list[str]

  3. CompetitiveAnalyzer 클래스:
     - __init__(
         entity_recognizer: EntityRecognizer | None = None,
         sentiment_analyzer: EntitySentimentAnalyzer | None = None,
         complaint_extractor: ComplaintExtractor | None = None,
         alternative_extractor: AlternativeExtractor | None = None
       )

  4. 분석 메서드:
     - analyze_posts(posts: list[Post]) -> CompetitiveReport:
       - 전체 경쟁 분석 파이프라인

     - get_entity_insight(
         entity_name: str,
         posts: list[Post]
       ) -> CompetitiveInsight:
       - 특정 엔티티 인사이트

  5. 리포트 출력:
     - to_markdown(report: CompetitiveReport) -> str
     - to_dict(report: CompetitiveReport) -> dict
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.competitive import CompetitiveAnalyzer, CompetitiveReport; a = CompetitiveAnalyzer(); print('CompetitiveAnalyzer OK')"
  </verify>
  <done>
  - 통합 CompetitiveAnalyzer 구현
  - 마크다운 리포트 출력
  </done>
</task>

<task type="auto">
  <name>Task 4: export 및 테스트</name>
  <files>src/reddit_insight/analysis/__init__.py, tests/test_competitive.py</files>
  <action>
  1. __init__.py 업데이트:
     - ComplaintType, Complaint, ComplaintExtractor export
     - ComparisonType, AlternativeComparison, AlternativeExtractor export
     - CompetitiveInsight, CompetitiveReport, CompetitiveAnalyzer export
     - __all__ 최종 업데이트

  2. tests/test_competitive.py 생성:
     - TestEntityRecognition: 엔티티 인식 테스트
     - TestSentimentAnalysis: 감성 분석 테스트
     - TestComplaintExtraction: 불만 추출 테스트
     - TestAlternativeExtraction: 대안 추출 테스트
     - TestCompetitiveAnalyzer: 통합 분석 테스트

  3. 통합 확인:
     - Phase 7 전체 모듈 import 테스트
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis import CompetitiveAnalyzer, ComplaintExtractor, AlternativeExtractor, EntityRecognizer, EntitySentimentAnalyzer; print('All Phase 7 exports OK')"
  - python -m pytest tests/test_competitive.py -v --collect-only 2>/dev/null || echo "Tests defined"
  </verify>
  <done>
  - Phase 7 모든 기능 export됨
  - 테스트 작성됨
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] ComplaintExtractor가 불만 추출
- [ ] AlternativeExtractor가 대안 비교 추출
- [ ] CompetitiveAnalyzer가 전체 파이프라인 실행
- [ ] 마크다운 리포트 출력 동작
</verification>

<success_criteria>

- 모든 태스크 완료
- 경쟁 분석 시스템 동작
- Phase 7 완료

</success_criteria>

<output>
After completion, create `.planning/phases/07-competitive-analysis/07-03-SUMMARY.md`
</output>
