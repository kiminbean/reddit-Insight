---
phase: 07-competitive-analysis
plan: 02
type: execute
depends_on: ["07-01"]
files_modified: [src/reddit_insight/analysis/sentiment.py]
---

<objective>
감성 분석 엔진을 구현한다.

Purpose: 제품/서비스에 대한 감성(긍정/부정/중립)을 분석
Output: SentimentAnalyzer, SentimentScore, 엔티티-감성 연결
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-competitive-analysis/07-01-PLAN.md

**Prior plan context:**
- EntityRecognizer로 제품/서비스 인식 가능
- ProductEntity에 name, entity_type, context 있음

**Sentiment approach (lightweight, rule-based):**
- VADER-like 어휘 기반 분석
- 긍정/부정 단어 사전
- 부정어, 강조어 처리
- 이모티콘/이모지 처리
</context>

<tasks>

<task type="auto">
  <name>Task 1: 감성 데이터 구조 및 어휘 사전</name>
  <files>src/reddit_insight/analysis/sentiment.py</files>
  <action>
  src/reddit_insight/analysis/sentiment.py 생성:

  1. Sentiment 열거형:
     - POSITIVE: 긍정
     - NEGATIVE: 부정
     - NEUTRAL: 중립
     - MIXED: 혼합 (긍정+부정)

  2. SentimentScore 데이터 클래스:
     - sentiment: Sentiment
     - positive_score: float (0-1)
     - negative_score: float (0-1)
     - neutral_score: float (0-1)
     - compound: float (-1 to 1, 종합 점수)
     - confidence: float (0-1)

  3. 감성 어휘 사전:
     POSITIVE_WORDS: set[str] = {
       "great", "awesome", "excellent", "amazing", "love",
       "best", "fantastic", "wonderful", "perfect", "brilliant",
       "recommend", "helpful", "easy", "fast", "reliable",
       "beautiful", "intuitive", "powerful", "impressive", ...
     }

     NEGATIVE_WORDS: set[str] = {
       "bad", "terrible", "awful", "horrible", "hate",
       "worst", "disappointing", "frustrating", "annoying", "broken",
       "slow", "buggy", "useless", "expensive", "complicated",
       "confusing", "unreliable", "poor", "waste", ...
     }

  4. 수정어 사전:
     NEGATORS: set[str] = {"not", "no", "never", "neither", "nobody", "nothing", "nowhere", "isn't", "aren't", "wasn't", "weren't", "don't", "doesn't", "didn't", "won't", "wouldn't", "couldn't", "shouldn't"}

     INTENSIFIERS: dict[str, float] = {
       "very": 1.5, "really": 1.5, "extremely": 2.0,
       "absolutely": 2.0, "totally": 1.5, "completely": 1.5,
       "so": 1.3, "quite": 1.2, "pretty": 1.1, ...
     }

     DIMINISHERS: dict[str, float] = {
       "slightly": 0.5, "somewhat": 0.6, "rather": 0.7,
       "a bit": 0.5, "kind of": 0.6, "sort of": 0.6, ...
     }
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.sentiment import Sentiment, SentimentScore, POSITIVE_WORDS, NEGATIVE_WORDS; print(f'Positive: {len(POSITIVE_WORDS)}, Negative: {len(NEGATIVE_WORDS)}')"
  </verify>
  <done>
  - 감성 데이터 구조 정의됨
  - 어휘 사전 구축 (긍정/부정/수정어)
  </done>
</task>

<task type="auto">
  <name>Task 2: 규칙 기반 감성 분석기</name>
  <files>src/reddit_insight/analysis/sentiment.py</files>
  <action>
  sentiment.py에 분석기 추가:

  1. SentimentAnalyzerConfig 데이터 클래스:
     - use_negation: bool = True
     - use_intensifiers: bool = True
     - neutral_threshold: float = 0.1
     - mixed_threshold: float = 0.3

  2. RuleBasedSentimentAnalyzer 클래스:
     - __init__(config: SentimentAnalyzerConfig | None = None)
     - _config: SentimentAnalyzerConfig
     - _tokenizer: RedditTokenizer

  3. 분석 메서드:
     - analyze(text: str) -> SentimentScore:
       - 텍스트 감성 분석
       - 수정어 처리 포함

     - _tokenize_with_context(text: str) -> list[tuple[str, str | None]]:
       - 토큰과 이전 단어 반환 (부정어 체크용)

     - _calculate_word_sentiment(
         word: str,
         prev_word: str | None
       ) -> float:
       - 단어별 감성 점수 (-1 to 1)
       - 부정어/강조어 적용

     - _aggregate_scores(word_scores: list[float]) -> SentimentScore:
       - 단어 점수 집계
       - compound 점수 계산
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.sentiment import RuleBasedSentimentAnalyzer; a = RuleBasedSentimentAnalyzer(); score = a.analyze('This product is really great and easy to use'); print(f'Compound: {score.compound:.2f}, Sentiment: {score.sentiment}')"
  </verify>
  <done>
  - 규칙 기반 감성 분석 구현
  - 부정어/강조어 처리 포함
  </done>
</task>

<task type="auto">
  <name>Task 3: 엔티티-감성 연결</name>
  <files>src/reddit_insight/analysis/sentiment.py</files>
  <action>
  sentiment.py에 엔티티 연결 추가:

  1. EntitySentiment 데이터 클래스:
     - entity: ProductEntity
     - sentiment: SentimentScore
     - context: str (분석된 문맥)
     - mention_count: int

  2. EntitySentimentAnalyzer 클래스:
     - __init__(
         entity_recognizer: EntityRecognizer | None = None,
         sentiment_analyzer: RuleBasedSentimentAnalyzer | None = None
       )

  3. 분석 메서드:
     - analyze_text(text: str) -> list[EntitySentiment]:
       - 텍스트에서 엔티티 추출 + 감성 분석
       - 엔티티 주변 문맥의 감성 계산

     - analyze_post(post: Post) -> list[EntitySentiment]:
       - Post 분석

     - analyze_posts(posts: list[Post]) -> dict[str, EntitySentiment]:
       - 여러 게시물 분석
       - 동일 엔티티 감성 집계

  4. 문맥 추출:
     - _extract_entity_context(
         text: str,
         entity_start: int,
         entity_end: int,
         window: int = 50
       ) -> str:
       - 엔티티 주변 문맥 추출

     - _aggregate_entity_sentiments(
         sentiments: list[EntitySentiment]
       ) -> dict[str, EntitySentiment]:
       - 동일 엔티티 감성 평균화
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.sentiment import EntitySentimentAnalyzer; a = EntitySentimentAnalyzer(); results = a.analyze_text('Slack is great for communication but Notion is even better'); print(f'Found {len(results)} entity sentiments')"
  </verify>
  <done>
  - 엔티티-감성 연결 구현
  - 엔티티별 감성 집계
  </done>
</task>

<task type="auto">
  <name>Task 4: export 및 통합</name>
  <files>src/reddit_insight/analysis/__init__.py</files>
  <action>
  1. __init__.py 업데이트:
     - Sentiment, SentimentScore export
     - RuleBasedSentimentAnalyzer, SentimentAnalyzerConfig export
     - EntitySentiment, EntitySentimentAnalyzer export
     - __all__ 업데이트

  2. 통합 검증:
     - 샘플 텍스트로 엔티티-감성 분석 테스트
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis import EntitySentimentAnalyzer, Sentiment, SentimentScore; print('All sentiment exports OK')"
  </verify>
  <done>
  - 감성 분석 모듈 export됨
  - 통합 동작 확인
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Sentiment 열거형 정의됨
- [ ] SentimentScore 데이터 구조 있음
- [ ] RuleBasedSentimentAnalyzer가 텍스트 감성 분석
- [ ] EntitySentimentAnalyzer가 엔티티-감성 연결
</verification>

<success_criteria>

- 모든 태스크 완료
- 감성 분석 엔진 동작
- 엔티티별 감성 분석 가능

</success_criteria>

<output>
After completion, create `.planning/phases/07-competitive-analysis/07-02-SUMMARY.md`
</output>
