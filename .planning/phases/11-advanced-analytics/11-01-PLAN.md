---
phase: 11-advanced-analytics
plan: 01
type: execute
---

<objective>
ML 기반 고급 분석을 위한 인프라 및 기반 클래스 구축.

Purpose: 시계열 예측, 이상 탐지, 클러스터링에 필요한 ML 라이브러리와 공통 추상화 레이어 구축
Output: ML 의존성 설치, 기반 클래스, 설정 구조
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@pyproject.toml
@src/reddit_insight/analysis/__init__.py
@src/reddit_insight/analysis/trends.py
</context>

<tasks>
<task type="auto">
  <name>Task 1: ML 의존성 추가</name>
  <files>pyproject.toml</files>
  <action>
  고급 분석에 필요한 ML 라이브러리를 pyproject.toml에 추가:

  - scikit-learn (이미 있음 - 버전 확인)
  - statsmodels>=0.14.0: ARIMA, 계절성 분해용
  - scipy>=1.11.0: 통계 분석, 이상 탐지용

  Prophet은 M1 MPS 환경에서 설치가 복잡하고 cmdstanpy 의존성 문제가 있어 제외.
  대신 statsmodels의 ARIMA/SARIMAX와 지수평활법(ETS) 사용.

  torch/tensorflow는 이 프로젝트의 데이터 규모(Reddit 포스트 분석)에 과도하므로 제외.
  scikit-learn + statsmodels로 충분한 예측 성능 달성 가능.
  </action>
  <verify>
  cd /Users/ibkim/Projects/reddit-Insight && source .venv/bin/activate && pip install -e . && python -c "import statsmodels; import scipy; print('OK')"
  </verify>
  <done>statsmodels, scipy 임포트 성공</done>
</task>

<task type="auto">
  <name>Task 2: ML 분석기 기반 클래스 생성</name>
  <files>src/reddit_insight/analysis/ml/__init__.py, src/reddit_insight/analysis/ml/base.py</files>
  <action>
  새로운 ml 서브패키지 생성하여 ML 분석기 기반 클래스 구현:

  1. src/reddit_insight/analysis/ml/ 디렉토리 생성

  2. base.py에 기반 클래스 정의:
     - MLAnalyzerBase: 모든 ML 분석기의 추상 기반 클래스
       - @abstractmethod analyze(data) -> AnalysisResult
       - @abstractmethod fit(data) -> None (optional, stateful 분석기용)
       - config: dataclass로 설정 관리

     - AnalysisResult: 분석 결과 공통 구조
       - result_type: Literal["prediction", "anomaly", "cluster", "topic"]
       - data: dict[str, Any]
       - metadata: dict (분석 시간, 데이터 크기 등)
       - confidence: float (0-1)

  3. __init__.py에서 기반 클래스 export

  기존 분석 모듈(trends.py, demand_detector.py 등)의 패턴 따르기:
  - Google 스타일 docstring
  - dataclass 기반 Config 클래스
  - TYPE_CHECKING을 통한 타입 힌트
  </action>
  <verify>
  python -c "from reddit_insight.analysis.ml import MLAnalyzerBase, AnalysisResult; print('Import OK')"
  </verify>
  <done>MLAnalyzerBase, AnalysisResult 클래스 임포트 성공</done>
</task>

<task type="auto">
  <name>Task 3: ML 분석 결과 데이터 모델</name>
  <files>src/reddit_insight/analysis/ml/models.py</files>
  <action>
  ML 분석 결과를 위한 구체적인 데이터 모델 정의:

  1. PredictionResult (시계열 예측용):
     - timestamps: list[datetime]
     - values: list[float]
     - lower_bound: list[float] (신뢰구간 하한)
     - upper_bound: list[float] (신뢰구간 상한)
     - confidence_level: float (예: 0.95)
     - model_name: str
     - metrics: dict (MAE, RMSE 등)

  2. AnomalyResult (이상 탐지용):
     - anomalies: list[AnomalyPoint]
       - AnomalyPoint: timestamp, value, anomaly_score, is_anomaly
     - threshold: float
     - method: str (예: "isolation_forest", "zscore")
     - total_points: int
     - anomaly_count: int

  3. ClusterResult (클러스터링용):
     - clusters: list[Cluster]
       - Cluster: id, label, size, centroid, keywords
     - n_clusters: int
     - silhouette_score: float
     - method: str (예: "kmeans", "dbscan")

  4. TopicResult (토픽 모델링용):
     - topics: list[Topic]
       - Topic: id, keywords, weight, representative_docs
     - n_topics: int
     - coherence_score: float
     - method: str (예: "lda", "nmf")

  모든 모델은 @dataclass로 정의, 직렬화를 위한 to_dict() 메서드 포함.
  </action>
  <verify>
  python -c "from reddit_insight.analysis.ml.models import PredictionResult, AnomalyResult, ClusterResult, TopicResult; print('Models OK')"
  </verify>
  <done>4개 결과 모델 클래스 임포트 성공</done>
</task>
</tasks>

<verification>
완료 전 확인사항:
- [ ] pip install -e . 성공 (새 의존성 설치)
- [ ] python -c "import statsmodels; import scipy" 성공
- [ ] src/reddit_insight/analysis/ml/ 디렉토리 존재
- [ ] 기반 클래스와 데이터 모델 임포트 가능
- [ ] 기존 테스트 통과: pytest tests/ -v --tb=short
</verification>

<success_criteria>
- ML 의존성 (statsmodels, scipy) 설치 완료
- MLAnalyzerBase 추상 클래스 구현
- 4가지 분석 결과 모델 (Prediction, Anomaly, Cluster, Topic) 정의
- 기존 코드와의 호환성 유지
</success_criteria>

<output>
완료 후 .planning/phases/11-advanced-analytics/11-01-SUMMARY.md 생성:

# Plan 11-01: ML Infrastructure Summary

**ML 기반 고급 분석을 위한 기반 인프라 구축 완료**

## Accomplishments
- [추가된 의존성 목록]
- [생성된 클래스 목록]

## Files Created/Modified
- pyproject.toml (의존성 추가)
- src/reddit_insight/analysis/ml/__init__.py
- src/reddit_insight/analysis/ml/base.py
- src/reddit_insight/analysis/ml/models.py

## Decisions Made
- [라이브러리 선택 근거]

## Next Phase Readiness
- 11-02 (시계열 예측) 진행 가능
</output>
