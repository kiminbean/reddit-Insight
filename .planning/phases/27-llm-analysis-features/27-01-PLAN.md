---
phase: 27-llm-analysis-features
plan: 01
type: execute
depends_on: ["26-01"]
files_modified: [src/reddit_insight/llm/analyzer.py, src/reddit_insight/dashboard/services/llm_service.py, src/reddit_insight/dashboard/routers/llm.py]
---

<objective>
LLM 기반 분석 기능을 구현한다: 시맨틱 요약, AI 카테고리화, 심층 인사이트.

Purpose: 기존 규칙 기반 분석을 LLM으로 보완하여 더 풍부한 인사이트 제공
Output: LLMAnalyzer, LLMService, LLM 분석 UI
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/reddit_insight/llm/client.py
@src/reddit_insight/llm/prompts.py

**LLM 분석 기능:**
- 게시물 요약: 핵심 내용 추출
- 카테고리화: 주제별 자동 분류
- 심층 감성: 뉘앙스 있는 감성 분석
- 인사이트 생성: 비즈니스 기회 해석
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement LLM Analyzer</name>
  <files>src/reddit_insight/llm/analyzer.py</files>
  <action>LLM 기반 분석기를 구현한다:

  ```python
  class LLMAnalyzer:
      def __init__(self, client: LLMClient, prompts: PromptManager):
          self.client = client
          self.prompts = prompts

      async def summarize_posts(self, posts: list[Post], max_posts: int = 50) -> str:
          """게시물 목록을 요약하여 핵심 논의 주제 추출"""
          prompt = self.prompts.get("SUMMARIZE_POSTS").format(
              posts=self._format_posts(posts[:max_posts])
          )
          return await self.client.complete(prompt)

      async def categorize_content(self, texts: list[str]) -> list[dict]:
          """텍스트를 카테고리로 분류
          Returns: [{"text": "...", "category": "...", "confidence": 0.9}]
          """

      async def analyze_sentiment_deep(self, text: str) -> dict:
          """심층 감성 분석
          Returns: {"sentiment": "positive", "confidence": 0.85,
                    "aspects": [{"topic": "price", "sentiment": "negative"}]}
          """

      async def generate_insights(self, analysis_data: dict) -> list[str]:
          """분석 결과에서 비즈니스 인사이트 생성"""
  ```

  JSON 응답 파싱 및 오류 처리 포함</action>
  <verify>pytest tests/llm/test_analyzer.py -v (mock client 사용)</verify>
  <done>LLMAnalyzer 구현 완료</done>
</task>

<task type="auto">
  <name>Task 2: Create LLM Dashboard Service</name>
  <files>src/reddit_insight/dashboard/services/llm_service.py, src/reddit_insight/dashboard/services/__init__.py</files>
  <action>대시보드용 LLM 서비스를 구현한다:

  ```python
  class LLMService:
      def __init__(self, analyzer: LLMAnalyzer, cache: CacheService):
          self.analyzer = analyzer
          self.cache = cache

      async def get_summary(self, subreddit: str) -> dict:
          """서브레딧 분석 요약 가져오기 (캐싱)"""
          cache_key = f"llm:summary:{subreddit}"
          cached = self.cache.get(cache_key)
          if cached:
              return cached

          data = get_current_data()
          if not data:
              return {"error": "No analysis data"}

          summary = await self.analyzer.summarize_posts(data.posts)
          result = {"summary": summary, "generated_at": datetime.now().isoformat()}
          self.cache.set(cache_key, result, ttl=3600)  # 1시간 캐시
          return result

      async def get_ai_categorization(self, texts: list[str]) -> list[dict]:
          """AI 카테고리화 결과"""

      async def get_deep_sentiment(self, text: str) -> dict:
          """심층 감성 분석 결과"""
  ```</action>
  <verify>pytest tests/dashboard/test_llm_service.py -v</verify>
  <done>LLMService 구현 완료</done>
</task>

<task type="auto">
  <name>Task 3: Add LLM Analysis UI</name>
  <files>src/reddit_insight/dashboard/routers/llm.py, src/reddit_insight/dashboard/templates/llm/index.html, src/reddit_insight/dashboard/app.py</files>
  <action>LLM 분석 UI를 대시보드에 추가한다:

  1. 새 라우터 (llm.py):
     - GET /dashboard/llm - LLM 분석 페이지
     - GET /dashboard/llm/summary - AI 요약 가져오기
     - POST /dashboard/llm/categorize - 텍스트 카테고리화
     - POST /dashboard/llm/sentiment - 심층 감성 분석

  2. UI 컴포넌트 (llm/index.html):
     - AI 요약 카드 (분석 핵심 내용)
     - 카테고리화 인터페이스 (텍스트 입력 → 결과)
     - 감성 분석 상세 뷰

  3. 네비게이션에 "AI Analysis" 메뉴 추가

  4. 로딩 상태 및 에러 핸들링:
     - API 키 미설정 시 안내 메시지
     - 처리 중 스피너 표시
     - 오류 시 친절한 에러 메시지</action>
  <verify>브라우저에서 /dashboard/llm 페이지 작동 확인</verify>
  <done>LLM 분석 UI 구현 완료</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] LLMAnalyzer 단위 테스트 통과
- [ ] LLMService 단위 테스트 통과
- [ ] /dashboard/llm 페이지 렌더링
- [ ] API 키 없을 때 graceful 처리
</verification>

<success_criteria>

- LLMAnalyzer: summarize, categorize, sentiment, insights 메서드
- LLMService: 대시보드 통합, 캐싱
- LLM 분석 UI 페이지
- API 키 미설정 시 안내 표시
</success_criteria>

<output>
After completion, create `.planning/phases/27-llm-analysis-features/27-01-SUMMARY.md`
</output>
