---
phase: 06-demand-discovery
plan: 03
type: execute
depends_on: ["06-02", "05-02"]
files_modified: [src/reddit_insight/analysis/demand_analyzer.py, tests/test_demand.py]
---

<objective>
수요 분류 및 우선순위화 시스템을 구현한다.

Purpose: 발견된 수요를 비즈니스 관점에서 분류하고 우선순위 부여
Output: DemandAnalyzer, 우선순위 점수, 수요 리포트
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-demand-discovery/06-01-PLAN.md
@.planning/phases/06-demand-discovery/06-02-PLAN.md

**Prior plan context:**
- DemandDetector로 패턴 탐지 가능
- DemandMatch에 신뢰도 점수 있음
- DemandCategory로 카테고리 분류됨

**Prioritization factors:**
- 빈도: 같은 수요 언급 횟수
- 구매 의향: WILLINGNESS_TO_PAY 카테고리 가중치
- 감정 강도: 불만/좌절 표현 강도
- 최신성: 최근 언급일수록 높은 점수
</context>

<tasks>

<task type="auto">
  <name>Task 1: 수요 클러스터링</name>
  <files>src/reddit_insight/analysis/demand_analyzer.py</files>
  <action>
  src/reddit_insight/analysis/demand_analyzer.py 생성:

  1. DemandCluster 데이터 클래스:
     - cluster_id: str
     - representative: str (대표 수요 텍스트)
     - matches: list[DemandMatch]
     - frequency: int (발생 빈도)
     - categories: list[DemandCategory]
     - keywords: list[str] (관련 키워드)

  2. DemandClusterer 클래스:
     - __init__(
         keyword_extractor: UnifiedKeywordExtractor | None = None,
         similarity_threshold: float = 0.7
       )

  3. 클러스터링 메서드:
     - cluster_demands(
         matches: list[DemandMatch]
       ) -> list[DemandCluster]:
       - 유사한 수요 그룹화
       - 키워드 기반 유사도 계산

     - _calculate_similarity(
         match1: DemandMatch,
         match2: DemandMatch
       ) -> float:
       - 텍스트 유사도 계산 (키워드 겹침)

     - _extract_representative(
         matches: list[DemandMatch]
       ) -> str:
       - 클러스터 대표 텍스트 선정
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.demand_analyzer import DemandCluster, DemandClusterer; print('DemandClusterer OK')"
  </verify>
  <done>
  - 수요 클러스터링 구현
  - 유사 수요 그룹화
  </done>
</task>

<task type="auto">
  <name>Task 2: 우선순위 점수 계산</name>
  <files>src/reddit_insight/analysis/demand_analyzer.py</files>
  <action>
  demand_analyzer.py에 추가:

  1. PriorityScore 데이터 클래스:
     - total_score: float (0-100)
     - frequency_score: float
     - payment_intent_score: float
     - urgency_score: float
     - recency_score: float
     - breakdown: dict[str, float]

  2. PriorityConfig 데이터 클래스:
     - frequency_weight: float = 0.3
     - payment_weight: float = 0.3
     - urgency_weight: float = 0.2
     - recency_weight: float = 0.2

  3. PriorityCalculator 클래스:
     - __init__(config: PriorityConfig | None = None)

  4. 점수 계산 메서드:
     - calculate_priority(cluster: DemandCluster) -> PriorityScore:
       - 클러스터 우선순위 계산

     - _frequency_score(cluster: DemandCluster) -> float:
       - 발생 빈도 기반 점수 (로그 스케일)

     - _payment_intent_score(cluster: DemandCluster) -> float:
       - WILLINGNESS_TO_PAY 비율

     - _urgency_score(cluster: DemandCluster) -> float:
       - PAIN_POINT 카테고리 강도

     - _recency_score(cluster: DemandCluster) -> float:
       - 최근 발생 비율 (시간 감쇠)
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.demand_analyzer import PriorityCalculator, PriorityScore; print('PriorityCalculator OK')"
  </verify>
  <done>
  - 우선순위 점수 시스템 구현
  - 4가지 요소 기반 복합 점수
  </done>
</task>

<task type="auto">
  <name>Task 3: 통합 분석기 및 리포트</name>
  <files>src/reddit_insight/analysis/demand_analyzer.py</files>
  <action>
  demand_analyzer.py에 추가:

  1. PrioritizedDemand 데이터 클래스:
     - cluster: DemandCluster
     - priority: PriorityScore
     - rank: int
     - business_potential: str (high/medium/low)

  2. DemandReport 데이터 클래스:
     - generated_at: datetime
     - total_demands: int
     - total_clusters: int
     - top_opportunities: list[PrioritizedDemand]
     - by_category: dict[DemandCategory, int]
     - recommendations: list[str]

  3. DemandAnalyzer 클래스:
     - __init__(
         detector: DemandDetector | None = None,
         clusterer: DemandClusterer | None = None,
         priority_calculator: PriorityCalculator | None = None
       )

  4. 분석 메서드:
     - analyze_posts(
         posts: list[Post],
         top_n: int = 10
       ) -> DemandReport:
       - 전체 파이프라인 실행

     - prioritize_clusters(
         clusters: list[DemandCluster]
       ) -> list[PrioritizedDemand]:
       - 클러스터 우선순위 정렬

  5. 리포트 출력:
     - to_markdown(report: DemandReport) -> str:
       - 마크다운 형식 리포트

     - to_dict(report: DemandReport) -> dict:
       - JSON 직렬화 형태
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis.demand_analyzer import DemandAnalyzer, DemandReport; a = DemandAnalyzer(); print('DemandAnalyzer OK')"
  </verify>
  <done>
  - 통합 DemandAnalyzer 구현
  - 마크다운 리포트 출력
  </done>
</task>

<task type="auto">
  <name>Task 4: export 및 테스트</name>
  <files>src/reddit_insight/analysis/__init__.py, tests/test_demand.py</files>
  <action>
  1. __init__.py 업데이트:
     - DemandCluster, DemandClusterer export
     - PriorityScore, PriorityCalculator export
     - DemandAnalyzer, DemandReport export
     - PrioritizedDemand export
     - __all__ 최종 업데이트

  2. tests/test_demand.py 생성:
     - TestDemandPatterns: 패턴 매칭 테스트
     - TestDemandDetector: 탐지기 테스트
     - TestDemandAnalyzer: 분석기 테스트

  3. 통합 확인:
     - Phase 6 전체 모듈 import 테스트
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.analysis import DemandAnalyzer, DemandDetector, DemandPatternLibrary, PriorityCalculator; print('All Phase 6 exports OK')"
  - python -m pytest tests/test_demand.py -v --collect-only 2>/dev/null || echo "Tests defined"
  </verify>
  <done>
  - Phase 6 모든 기능 export됨
  - 기본 테스트 작성됨
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] DemandClusterer가 유사 수요 그룹화
- [ ] PriorityCalculator가 우선순위 점수 계산
- [ ] DemandAnalyzer가 전체 파이프라인 실행
- [ ] 마크다운 리포트 출력 동작
</verification>

<success_criteria>

- 모든 태스크 완료
- 수요 우선순위화 시스템 동작
- 비즈니스 기회 리포트 생성 가능
- Phase 6 완료

</success_criteria>

<output>
After completion, create `.planning/phases/06-demand-discovery/06-03-SUMMARY.md`
</output>
