---
phase: 02-reddit-api
plan: 01
type: execute
depends_on: ["01-02"]
files_modified: [src/reddit_insight/reddit/__init__.py, src/reddit_insight/reddit/client.py, src/reddit_insight/reddit/auth.py, src/reddit_insight/reddit/models.py, pyproject.toml]
---

<objective>
Reddit API 클라이언트 및 인증 시스템을 구축한다.

Purpose: Reddit 데이터 수집을 위한 안정적인 API 클라이언트 기반 마련
Output: PRAW 기반 Reddit 클라이언트, OAuth2 인증, Pydantic 데이터 모델
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

**Research findings:**
- PRAW (Python Reddit API Wrapper)이 인증/rate limiting 자동 처리
- OAuth2 인증: client_id, client_secret, user_agent 필요
- Rate limit: 60 requests/minute (OAuth 인증 시)
- user_agent 형식: `<platform>:<app ID>:<version> (by /u/<username>)`

**Prior phase context:**
- config.py에 reddit_client_id, reddit_client_secret 설정 정의됨
- pydantic, httpx 의존성 설치됨

**Constraints:**
- 무료 API만 사용 (유료 티어 제외)
- PRAW 라이브러리 사용
</context>

<tasks>

<task type="auto">
  <name>Task 1: 의존성 추가 및 reddit 모듈 구조 생성</name>
  <files>pyproject.toml, src/reddit_insight/reddit/__init__.py</files>
  <action>
  1. pyproject.toml에 praw 의존성 추가:
     - dependencies에 "praw>=7.7.0" 추가

  2. src/reddit_insight/reddit/ 디렉토리 생성

  3. src/reddit_insight/reddit/__init__.py 생성:
     - 모듈 레벨 export 정의
     - __all__ = ["RedditClient", "get_reddit_client", "Post", "Comment", "Subreddit"]
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src')"
  - cat pyproject.toml | grep praw
  </verify>
  <done>
  - praw 의존성이 pyproject.toml에 추가됨
  - reddit 모듈 디렉토리 구조 생성됨
  </done>
</task>

<task type="auto">
  <name>Task 2: Pydantic 데이터 모델 정의</name>
  <files>src/reddit_insight/reddit/models.py</files>
  <action>
  src/reddit_insight/reddit/models.py 생성:

  1. Post 모델:
     - id: str
     - title: str
     - selftext: str
     - author: str
     - subreddit: str
     - score: int
     - num_comments: int
     - created_utc: datetime
     - url: str
     - permalink: str
     - is_self: bool

  2. Comment 모델:
     - id: str
     - body: str
     - author: str
     - subreddit: str
     - score: int
     - created_utc: datetime
     - parent_id: str
     - post_id: str

  3. SubredditInfo 모델:
     - name: str
     - display_name: str
     - title: str
     - description: str
     - subscribers: int
     - created_utc: datetime
     - over18: bool

  모든 모델은 pydantic.BaseModel 상속, frozen=True 설정
  from_praw() 클래스 메서드로 PRAW 객체에서 변환
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.reddit.models import Post, Comment, SubredditInfo; print('Models OK')"
  </verify>
  <done>
  - Post, Comment, SubredditInfo 모델 정의됨
  - from_praw() 변환 메서드 구현됨
  </done>
</task>

<task type="auto">
  <name>Task 3: Reddit 인증 모듈 구현</name>
  <files>src/reddit_insight/reddit/auth.py</files>
  <action>
  src/reddit_insight/reddit/auth.py 생성:

  1. RedditAuth 클래스:
     - __init__(client_id, client_secret, user_agent)
     - validate() 메서드: 자격증명 유효성 검사
     - is_configured() 프로퍼티: 설정 완료 여부

  2. get_user_agent() 함수:
     - 표준 형식으로 user_agent 생성
     - 형식: "python:reddit-insight:0.1.0 (by /u/reddit_insight_bot)"

  3. AuthenticationError 예외 클래스:
     - 인증 실패 시 발생

  주의: 실제 인증은 client.py에서 수행, 여기서는 설정 검증만
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.reddit.auth import RedditAuth, get_user_agent; print(get_user_agent())"
  </verify>
  <done>
  - RedditAuth 클래스로 자격증명 관리
  - user_agent 생성 함수 구현
  </done>
</task>

<task type="auto">
  <name>Task 4: Reddit 클라이언트 구현</name>
  <files>src/reddit_insight/reddit/client.py</files>
  <action>
  src/reddit_insight/reddit/client.py 생성:

  1. RedditClient 클래스:
     - __init__(settings: Settings | None = None)
     - _praw: praw.Reddit 인스턴스 (lazy init)
     - _ensure_connected() 메서드

  2. 연결 관리:
     - connect() 메서드: PRAW 인스턴스 생성
     - is_connected 프로퍼티
     - read_only 모드 지원 (인증 없이 읽기만)

  3. 기본 메서드 (Phase 2-02, 2-03에서 확장):
     - get_subreddit(name: str) -> praw.Subreddit
     - search_subreddits(query: str) -> list

  4. get_reddit_client() 함수:
     - 싱글톤 패턴으로 클라이언트 인스턴스 반환
     - functools.lru_cache 사용

  주의:
  - 자격증명 없으면 read_only 모드로 동작
  - rate limiting은 PRAW가 자동 처리
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.reddit.client import RedditClient; c = RedditClient(); print('Client created:', c)"
  </verify>
  <done>
  - RedditClient 클래스가 PRAW를 래핑
  - read_only 모드 지원
  - get_reddit_client() 싱글톤 구현
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] praw 의존성이 pyproject.toml에 추가됨
- [ ] Post, Comment, SubredditInfo 모델이 정의됨
- [ ] RedditClient가 read_only 모드로 동작 가능
- [ ] from reddit_insight.reddit import RedditClient 가능
</verification>

<success_criteria>

- 모든 태스크 완료
- Reddit API 클라이언트가 read_only 모드로 초기화 가능
- Pydantic 모델이 PRAW 객체 변환 지원
- 인증 없이도 기본 기능 동작

</success_criteria>

<output>
After completion, create `.planning/phases/02-reddit-api/02-01-SUMMARY.md`
</output>
