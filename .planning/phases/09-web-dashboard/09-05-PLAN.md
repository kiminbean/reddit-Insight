---
phase: 09-web-dashboard
plan: 05
type: execute
depends_on: ["09-04"]
files_modified: [src/reddit_insight/dashboard/routers/search.py, src/reddit_insight/dashboard/app.py]
---

<objective>
필터 및 검색 기능을 구현한다.

Purpose: 대시보드 전반에 걸친 검색 및 필터링 기능
Output: 글로벌 검색, 고급 필터, 검색 결과 뷰
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-web-dashboard/09-01-PLAN.md

**Prior plan context:**
- 모든 뷰 라우터 구현됨
- HTMX로 동적 업데이트

**Search scope:**
- 키워드 검색
- 엔티티 검색
- 인사이트 검색
- 수요 텍스트 검색
</context>

<tasks>

<task type="auto">
  <name>Task 1: 검색 라우터</name>
  <files>src/reddit_insight/dashboard/routers/search.py</files>
  <action>
  routers/search.py 생성:

  1. router = APIRouter(prefix="/search", tags=["search"])

  2. 라우트:
     - GET /search/: 검색 결과 페이지
     - GET /search/suggestions: 자동완성 제안 (HTMX)
     - GET /search/results: 검색 결과 (HTMX partial)

  3. 쿼리 파라미터:
     - q: str (검색어)
     - type: str | None (keywords/entities/insights/demands)
     - limit: int = 20

  4. SearchService 클래스:
     - search(
         query: str,
         search_type: str | None,
         limit: int
       ) -> SearchResults

     - get_suggestions(
         query: str,
         limit: int = 5
       ) -> list[str]
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.dashboard.routers.search import router; print('Search router OK')"
  </verify>
  <done>
  - 검색 라우터 구현
  </done>
</task>

<task type="auto">
  <name>Task 2: 검색 서비스</name>
  <files>src/reddit_insight/dashboard/services/search_service.py</files>
  <action>
  services/search_service.py 생성:

  1. SearchResults 데이터 클래스:
     - query: str
     - total_count: int
     - keywords: list[KeywordResult]
     - entities: list[EntityResult]
     - insights: list[InsightResult]
     - demands: list[DemandResult]

  2. 결과 타입별 데이터 클래스:
     - KeywordResult: keyword, frequency, trend
     - EntityResult: name, type, sentiment
     - InsightResult: id, title, type, confidence
     - DemandResult: id, text, category, priority

  3. SearchService 구현:
     - _search_keywords(query: str) -> list[KeywordResult]
     - _search_entities(query: str) -> list[EntityResult]
     - _search_insights(query: str) -> list[InsightResult]
     - _search_demands(query: str) -> list[DemandResult]
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.dashboard.services.search_service import SearchService, SearchResults; print('SearchService OK')"
  </verify>
  <done>
  - 검색 서비스 구현
  </done>
</task>

<task type="auto">
  <name>Task 3: 검색 UI</name>
  <files>src/reddit_insight/dashboard/templates/search/, src/reddit_insight/dashboard/templates/base.html</files>
  <action>
  1. base.html 업데이트:
     - 글로벌 검색 바 (헤더)
     - HTMX 자동완성 통합
     - 검색 아이콘 + 입력 필드

  2. templates/search/ 디렉토리:
     - search/index.html:
       - 검색 결과 페이지
       - 결과 유형별 탭
       - 필터 사이드바

     - search/partials/results.html:
       - 통합 검색 결과
       - 섹션별 구분 (Keywords, Entities, Insights, Demands)

     - search/partials/suggestions.html:
       - 자동완성 드롭다운

  3. 검색 결과 카드:
     - 유형별 아이콘
     - 하이라이트된 매칭 텍스트
     - 상세 페이지 링크
  </action>
  <verify>
  - ls src/reddit_insight/dashboard/templates/search/index.html
  </verify>
  <done>
  - 검색 UI 구현
  </done>
</task>

<task type="auto">
  <name>Task 4: 필터 컴포넌트</name>
  <files>src/reddit_insight/dashboard/templates/components/filters.html</files>
  <action>
  1. templates/components/ 디렉토리:
     - components/filters.html:
       - 재사용 가능한 필터 컴포넌트
       - 날짜 범위 선택
       - 카테고리 체크박스
       - 점수 범위 슬라이더

     - components/pagination.html:
       - HTMX 페이지네이션
       - 페이지 번호 + 이전/다음

  2. 각 뷰에 필터 적용:
     - trends/index.html에 필터 include
     - demands/index.html에 필터 include
     - competition/index.html에 필터 include
     - insights/index.html에 필터 include

  3. app.py 최종 업데이트:
     - search 라우터 등록
     - 모든 라우터 확인
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.dashboard.app import app; print(f'Routes: {len(app.routes)}')"
  </verify>
  <done>
  - 필터 컴포넌트 구현
  - Phase 9 완료
  </done>
</task>

</tasks>

<verification>
- [ ] 글로벌 검색 동작
- [ ] 자동완성 동작
- [ ] 필터 적용 동작
</verification>

<success_criteria>
- 모든 태스크 완료
- 검색 및 필터 동작
- Phase 9 완료
</success_criteria>

<output>
After completion, create `.planning/phases/09-web-dashboard/09-05-SUMMARY.md`
</output>
