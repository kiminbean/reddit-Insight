---
phase: 09-web-dashboard
plan: 03
type: execute
depends_on: ["09-01"]
files_modified: [src/reddit_insight/dashboard/routers/demands.py, src/reddit_insight/dashboard/routers/competition.py]
---

<objective>
수요 및 경쟁 분석 뷰를 구현한다.

Purpose: 수요 발견과 경쟁 분석 결과를 시각화
Output: Demands 페이지, Competition 페이지, 분석 카드
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-web-dashboard/09-01-PLAN.md

**Prior plan context:**
- FastAPI 앱 설정됨
- TrendService 패턴 참조

**Data sources:**
- DemandAnalyzer: 수요 분석 결과
- CompetitiveAnalyzer: 경쟁 분석 결과
</context>

<tasks>

<task type="auto">
  <name>Task 1: 수요 분석 라우터</name>
  <files>src/reddit_insight/dashboard/routers/demands.py</files>
  <action>
  routers/demands.py 생성:

  1. router = APIRouter(prefix="/demands", tags=["demands"])

  2. 라우트:
     - GET /demands/: 수요 분석 메인 페이지
     - GET /demands/list: 수요 목록 (HTMX partial)
     - GET /demands/{demand_id}: 수요 상세
     - GET /demands/categories: 카테고리별 분포 (JSON)

  3. DemandService 클래스:
     - get_demands(
         category: DemandCategory | None,
         min_priority: float,
         limit: int
       ) -> list[DemandView]

     - get_demand_detail(demand_id: str) -> DemandDetail

     - get_category_stats() -> dict[str, int]

  4. DemandView 데이터 클래스:
     - id: str
     - category: str
     - text: str
     - priority_score: float
     - source_count: int
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.dashboard.routers.demands import router; print('Demands router OK')"
  </verify>
  <done>
  - 수요 분석 라우터 구현
  </done>
</task>

<task type="auto">
  <name>Task 2: 경쟁 분석 라우터</name>
  <files>src/reddit_insight/dashboard/routers/competition.py</files>
  <action>
  routers/competition.py 생성:

  1. router = APIRouter(prefix="/competition", tags=["competition"])

  2. 라우트:
     - GET /competition/: 경쟁 분석 메인 페이지
     - GET /competition/entities: 엔티티 목록 (HTMX partial)
     - GET /competition/entity/{name}: 엔티티 상세
     - GET /competition/sentiment-chart: 감성 차트 (JSON)
     - GET /competition/complaints: 불만 목록 (HTMX partial)

  3. CompetitionService 클래스:
     - get_entities(limit: int) -> list[EntityView]
     - get_entity_detail(name: str) -> EntityDetail
     - get_top_complaints(limit: int) -> list[ComplaintView]
     - get_sentiment_distribution() -> dict[str, float]

  4. EntityView 데이터 클래스:
     - name: str
     - entity_type: str
     - mention_count: int
     - sentiment_score: float
     - sentiment_label: str (positive/neutral/negative)
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.dashboard.routers.competition import router; print('Competition router OK')"
  </verify>
  <done>
  - 경쟁 분석 라우터 구현
  </done>
</task>

<task type="auto">
  <name>Task 3: 수요/경쟁 템플릿</name>
  <files>src/reddit_insight/dashboard/templates/demands/, src/reddit_insight/dashboard/templates/competition/</files>
  <action>
  1. templates/demands/ 디렉토리:
     - demands/index.html: 메인 페이지
       - 카테고리 필터
       - 우선순위 슬라이더
       - 수요 카드 그리드
     - demands/partials/demand_list.html: 수요 목록
     - demands/partials/demand_card.html: 개별 수요 카드

  2. templates/competition/ 디렉토리:
     - competition/index.html: 메인 페이지
       - 엔티티 테이블
       - 감성 분포 차트
       - 불만 목록
     - competition/partials/entity_list.html: 엔티티 목록
     - competition/partials/complaint_list.html: 불만 목록
     - competition/entity_detail.html: 엔티티 상세

  3. 공통 컴포넌트:
     - 감성 배지 (긍정/중립/부정 색상)
     - 우선순위 바
  </action>
  <verify>
  - ls src/reddit_insight/dashboard/templates/demands/index.html
  - ls src/reddit_insight/dashboard/templates/competition/index.html
  </verify>
  <done>
  - 수요/경쟁 템플릿 구현
  </done>
</task>

<task type="auto">
  <name>Task 4: 앱에 라우터 등록</name>
  <files>src/reddit_insight/dashboard/app.py</files>
  <action>
  1. app.py 업데이트:
     - from .routers import demands, competition
     - app.include_router(demands.router)
     - app.include_router(competition.router)

  2. 네비게이션 업데이트:
     - base.html에 Demands, Competition 링크

  3. services/__init__.py 업데이트:
     - DemandService, CompetitionService export
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.dashboard.app import app; print('App with demands/competition OK')"
  </verify>
  <done>
  - 라우터 등록 완료
  </done>
</task>

</tasks>

<verification>
- [ ] /demands/ 페이지 동작
- [ ] /competition/ 페이지 동작
- [ ] 카테고리 필터 동작
</verification>

<success_criteria>
- 모든 태스크 완료
- 수요/경쟁 뷰 동작
</success_criteria>

<output>
After completion, create `.planning/phases/09-web-dashboard/09-03-SUMMARY.md`
</output>
