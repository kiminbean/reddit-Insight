---
phase: 08-business-insights
plan: 01
type: execute
depends_on: ["06-03", "07-03"]
files_modified: [src/reddit_insight/insights/rules_engine.py, src/reddit_insight/insights/__init__.py]
---

<objective>
인사이트 생성 규칙 엔진을 구현한다.

Purpose: 수요 분석과 경쟁 분석 결과를 결합하여 비즈니스 인사이트 생성
Output: InsightRule, RulesEngine, 자동 인사이트 생성
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

**Prior phase context:**
- Phase 6: DemandAnalyzer, PrioritizedDemand, DemandReport
- Phase 7: CompetitiveAnalyzer, CompetitiveReport, EntitySentiment

**Insight generation approach:**
- 규칙 기반: 조건-결론 패턴
- 수요 + 경쟁 데이터 결합
- 자동 추천 생성
</context>

<tasks>

<task type="auto">
  <name>Task 1: 인사이트 데이터 구조</name>
  <files>src/reddit_insight/insights/rules_engine.py, src/reddit_insight/insights/__init__.py</files>
  <action>
  src/reddit_insight/insights/ 패키지 생성:

  1. InsightType 열거형:
     - MARKET_GAP: 시장 공백 (수요 있으나 공급 부족)
     - IMPROVEMENT_OPPORTUNITY: 개선 기회 (불만 많은 기존 제품)
     - EMERGING_TREND: 떠오르는 트렌드 (급상승 키워드)
     - COMPETITIVE_WEAKNESS: 경쟁사 약점
     - UNMET_NEED: 미충족 수요

  2. Insight 데이터 클래스:
     - insight_id: str
     - insight_type: InsightType
     - title: str
     - description: str
     - evidence: list[str] (근거 데이터)
     - confidence: float (0-1)
     - priority: float (0-100)
     - related_entities: list[str]
     - related_demands: list[str]
     - created_at: datetime

  3. InsightEvidence 데이터 클래스:
     - source_type: str ("demand", "complaint", "sentiment", "trend")
     - source_id: str
     - summary: str
     - weight: float
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.insights import InsightType, Insight; print('Insight structures OK')"
  </verify>
  <done>
  - insights 패키지 생성
  - 인사이트 데이터 구조 정의
  </done>
</task>

<task type="auto">
  <name>Task 2: 인사이트 규칙 정의</name>
  <files>src/reddit_insight/insights/rules_engine.py</files>
  <action>
  rules_engine.py에 규칙 정의:

  1. InsightRule 데이터 클래스:
     - rule_id: str
     - name: str
     - insight_type: InsightType
     - condition: Callable[[AnalysisContext], bool]
     - generate: Callable[[AnalysisContext], Insight]
     - priority: int = 0

  2. AnalysisContext 데이터 클래스:
     - demands: list[PrioritizedDemand]
     - complaints: list[Complaint]
     - entity_sentiments: dict[str, EntitySentiment]
     - rising_keywords: list[RisingScore]
     - alternatives: list[AlternativeComparison]

  3. 기본 규칙 정의:
     MARKET_GAP_RULE:
       - 조건: 수요 빈도 높음 + 관련 제품 언급 적음
       - 인사이트: "X에 대한 수요가 있으나 시장에 적절한 솔루션이 부족"

     IMPROVEMENT_RULE:
       - 조건: 제품 불만 높음 + 대안 탐색 많음
       - 인사이트: "X 제품 사용자들의 불만이 높고 대안을 찾고 있음"

     EMERGING_TREND_RULE:
       - 조건: Rising Score 높음 + 수요 패턴 매칭
       - 인사이트: "X가 급부상하는 트렌드로 비즈니스 기회 존재"

     COMPETITIVE_WEAKNESS_RULE:
       - 조건: 특정 제품 부정 감성 + 경쟁사 긍정 감성
       - 인사이트: "X의 약점이 Y의 강점과 대비됨"
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.insights.rules_engine import InsightRule, AnalysisContext; print('InsightRule OK')"
  </verify>
  <done>
  - InsightRule 구조 정의
  - 4가지 기본 규칙 정의
  </done>
</task>

<task type="auto">
  <name>Task 3: 규칙 엔진 구현</name>
  <files>src/reddit_insight/insights/rules_engine.py</files>
  <action>
  rules_engine.py에 RulesEngine 클래스 추가:

  1. RulesEngine 클래스:
     - __init__(rules: list[InsightRule] | None = None)
     - _rules: list[InsightRule]

  2. 규칙 관리:
     - add_rule(rule: InsightRule)
     - remove_rule(rule_id: str)
     - get_rules() -> list[InsightRule]
     - load_default_rules()

  3. 인사이트 생성:
     - generate_insights(context: AnalysisContext) -> list[Insight]:
       - 모든 규칙 평가
       - 조건 만족 시 인사이트 생성
       - 우선순위 정렬

     - evaluate_rule(
         rule: InsightRule,
         context: AnalysisContext
       ) -> Insight | None:
       - 단일 규칙 평가

  4. 컨텍스트 빌더:
     - build_context(
         demand_report: DemandReport | None = None,
         competitive_report: CompetitiveReport | None = None,
         trend_report: TrendReport | None = None
       ) -> AnalysisContext:
       - 분석 결과를 컨텍스트로 변환
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.insights.rules_engine import RulesEngine; e = RulesEngine(); e.load_default_rules(); print(f'Loaded {len(e._rules)} rules')"
  </verify>
  <done>
  - RulesEngine 구현
  - 기본 규칙 로딩
  </done>
</task>

<task type="auto">
  <name>Task 4: export 및 검증</name>
  <files>src/reddit_insight/insights/__init__.py</files>
  <action>
  1. __init__.py 업데이트:
     - InsightType, Insight, InsightEvidence export
     - InsightRule, AnalysisContext export
     - RulesEngine export
     - __all__ 정의

  2. 통합 검증:
     - 샘플 데이터로 인사이트 생성 테스트
  </action>
  <verify>
  - python -c "import sys; sys.path.insert(0, 'src'); from reddit_insight.insights import RulesEngine, InsightType, Insight; print('All insight exports OK')"
  </verify>
  <done>
  - insights 모듈 export됨
  </done>
</task>

</tasks>

<verification>
- [ ] InsightType, Insight 데이터 구조 정의됨
- [ ] InsightRule로 규칙 정의 가능
- [ ] RulesEngine이 인사이트 자동 생성
</verification>

<success_criteria>
- 모든 태스크 완료
- 규칙 기반 인사이트 생성 동작
</success_criteria>

<output>
After completion, create `.planning/phases/08-business-insights/08-01-SUMMARY.md`
</output>
