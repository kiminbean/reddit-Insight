# Plan 12-01: Dashboard Data Integration Verification

## Objective

대시보드 서비스들의 실제 데이터 연동 상태를 검증하고, 누락된 부분을 보완한다.

## Execution Context

```
src/reddit_insight/dashboard/
├── data_store.py           # AnalysisData 저장/조회 (이미 구현)
├── routers/
│   ├── demands.py          # DemandService (get_current_data 사용 중)
│   └── competition.py      # CompetitionService (get_current_data 사용 중)
├── services_module.py      # DashboardService (get_analysis_history 사용 중)
└── trend_service.py        # TrendService (get_current_data 사용 중)
```

## Context

### 현재 상태

코드 분석 결과, 대부분의 데이터 연동이 이미 구현되어 있음:

1. **DemandService** (`demands.py:166-205`):
   - `get_current_data()` 호출하여 `data.demands["top_opportunities"]` 사용
   - 실제 데이터 없을 때만 빈 리스트 반환 (데모 데이터 사용 안 함)

2. **CompetitionService** (`competition.py:171-195`):
   - `get_current_data()` 호출하여 `data.competition["insights"]` 사용
   - 실제 데이터 없을 때만 빈 리스트 반환

3. **DashboardService** (`services_module.py:86-109`):
   - `get_analysis_history()` 호출하여 DB에서 분석 이력 조회

### 검증 필요 항목

1. 분석 파이프라인이 `data_store.set_current_data()` 호출하는지 확인
2. demands/competition 데이터 구조가 서비스 기대 구조와 일치하는지 확인
3. E2E 테스트: 분석 실행 → 대시보드 표시 흐름 검증

## Tasks

### Task 1: 분석 파이프라인 데이터 저장 확인

**목표**: CLI `analyze` 명령이 분석 결과를 `data_store`에 저장하는지 확인

**파일**: `src/reddit_insight/cli/commands.py` (또는 관련 파일)

**작업**:
- 분석 파이프라인이 `set_current_data()` 호출하는 코드 확인
- 저장되는 데이터 구조 확인 (demands, competition 필드)

### Task 2: 데이터 구조 일치 검증

**목표**: 저장되는 데이터 구조와 서비스 기대 구조 일치 확인

**검증 항목**:
```python
# DemandService가 기대하는 구조:
data.demands = {
    "top_opportunities": [
        {"representative": str, "priority_score": float, "size": int, "business_potential": str}
    ],
    "by_category": {str: int},
    "recommendations": [str]
}

# CompetitionService가 기대하는 구조:
data.competition = {
    "insights": [
        {"entity_name": str, "entity_type": str, "mention_count": int,
         "sentiment_compound": float, "top_complaints": list}
    ],
    "top_complaints": [{"text": str, "severity": float}],
    "popular_switches": [{"from": str, "to": str, "count": int}],
    "recommendations": [str]
}
```

### Task 3: 통합 테스트 작성

**목표**: 분석 → 대시보드 데이터 흐름 E2E 테스트

**파일**: `tests/dashboard/test_data_integration.py`

**테스트 케이스**:
1. `set_current_data()` 후 `DemandService.get_demands()` 데이터 반환 확인
2. `set_current_data()` 후 `CompetitionService.get_entities()` 데이터 반환 확인
3. `save_to_database()` 후 `get_analysis_history()` 기록 반환 확인

## Verification

```bash
# 1. 기존 테스트 실행
pytest tests/dashboard/ -v

# 2. 새 통합 테스트 실행
pytest tests/dashboard/test_data_integration.py -v

# 3. 대시보드 서버 실행 후 수동 확인
PYTHONPATH=src uvicorn reddit_insight.dashboard.app:app --port 8888
# 브라우저에서 http://localhost:8888/dashboard 확인
```

## Success Criteria

- [ ] 분석 파이프라인이 data_store에 데이터 저장 확인
- [ ] demands/competition 데이터 구조 일치 확인
- [ ] 통합 테스트 3개 이상 통과
- [ ] 대시보드에서 실제 데이터 표시 확인 (수동)

## Output

- `tests/dashboard/test_data_integration.py` 생성
- 필요시 데이터 구조 불일치 수정
- 12-01-SUMMARY.md 작성
